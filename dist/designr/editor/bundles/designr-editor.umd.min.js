!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ngx-markdown"),require("@angular/core"),require("@angular/common"),require("@angular/forms"),require("@designr/control"),require("@designr/core"),require("@designr/page"),require("rxjs/operators"),require("@angular/animations")):"function"==typeof define&&define.amd?define("@designr/editor",["exports","ngx-markdown","@angular/core","@angular/common","@angular/forms","@designr/control","@designr/core","@designr/page","rxjs/operators","@angular/animations"],t):t(((e=e||self).designr=e.designr||{},e.designr.editor={}),e.ngxMarkdown,e.ng.core,e.ng.common,e.ng.forms,e.control,e.core,e.page,e.rxjs.operators,e.ng.animations)}(this,(function(e,t,n,o,r,i,a,c,l,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function u(e,t){function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}var m=new n.InjectionToken("editor.config"),g=function(e){e&&(this.enabled=e.enabled||!1)},v=function(){function e(e){e=e||{},this.options=new g(e)}return e.ɵfac=function(t){return new(t||e)(n["ɵɵinject"](m))},e.ɵprov=n["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac,providedIn:"root"}),e}();function y(e,t){if(1&e&&(n["ɵɵelementStart"](0,"div"),n["ɵɵelement"](1,"control-outlet",12),n["ɵɵelementEnd"]()),2&e){var o=t.$implicit;n["ɵɵnextContext"]();var r=n["ɵɵreference"](2);n["ɵɵadvance"](1),n["ɵɵclassMapInterpolate1"]("fieldset__field fieldset__field--",o.schema,""),n["ɵɵproperty"]("option",o)("form",r)}}var b=function(e){return{active:e}},h=function(e){return{"btn--busy":e}};function M(e,t){if(1&e){var o=n["ɵɵgetCurrentView"]();n["ɵɵelementContainerStart"](0),n["ɵɵelementStart"](1,"form",1,2),n["ɵɵlistener"]("ngSubmit",(function(e){n["ɵɵrestoreView"](o);var t=n["ɵɵreference"](2),r=n["ɵɵnextContext"]();return t.valid&&r.onSubmit(t.value)})),n["ɵɵelementStart"](3,"div",3),n["ɵɵelementStart"](4,"span",4),n["ɵɵtext"](5),n["ɵɵelementEnd"](),n["ɵɵelementStart"](6,"span",5),n["ɵɵtext"](7),n["ɵɵelementEnd"](),n["ɵɵelementStart"](8,"span",6),n["ɵɵtext"](9),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelement"](10,"hr"),n["ɵɵelement"](11,"h2",7),n["ɵɵelement"](12,"hr"),n["ɵɵtemplate"](13,y,2,5,"div",8),n["ɵɵelementStart"](14,"div",9),n["ɵɵelementStart"](15,"button",10),n["ɵɵlistener"]("click",(function(e){return n["ɵɵrestoreView"](o),n["ɵɵnextContext"]().onReset()})),n["ɵɵelementStart"](16,"span"),n["ɵɵtext"](17,"Annulla"),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementStart"](18,"button",11),n["ɵɵelementStart"](19,"span"),n["ɵɵtext"](20,"Salva"),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementEnd"](),n["ɵɵelementContainerEnd"]()}if(2&e){var r=n["ɵɵreference"](2),i=n["ɵɵnextContext"]();n["ɵɵadvance"](1),n["ɵɵproperty"]("formGroup",r),n["ɵɵadvance"](4),n["ɵɵtextInterpolate"](i.page.id),n["ɵɵadvance"](1),n["ɵɵproperty"]("ngClass",n["ɵɵpureFunction1"](10,b,i.page.active)),n["ɵɵadvance"](1),n["ɵɵtextInterpolate"](i.page.active?"active":"inactive"),n["ɵɵadvance"](2),n["ɵɵtextInterpolate"](i.componentName),n["ɵɵadvance"](2),n["ɵɵproperty"]("innerHTML",i.page.title,n["ɵɵsanitizeHtml"]),n["ɵɵadvance"](2),n["ɵɵproperty"]("ngForOf",i.options),n["ɵɵadvance"](2),n["ɵɵproperty"]("disabled",i.submitted||!r.valid),n["ɵɵadvance"](3),n["ɵɵproperty"]("disabled",i.submitted||!r.valid)("ngClass",n["ɵɵpureFunction1"](12,h,i.busy))}}var C=function(e){function a(t,n,o,r,i){var a=e.call(this)||this;return a.platformId=t,a.configService=n,a.markdownService=o,a.formService=r,a.pageResolverService=i,a.busy=!1,a.submitted=!1,a}return u(a,e),Object.defineProperty(a.prototype,"page",{get:function(){return this._page},set:function(e){var t=this;this._pageCopy=Object.assign({},e),this._page=e,this._page?(this.options=this.formService.getOptions(this.getControlsByPage(e)),this.form=this.formService.getFormGroup(this.options),this.form.valueChanges.subscribe((function(e){t.onAssign(e)}))):(this.options=[],this.form=null)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"componentName",{get:function(){if(this._page){var e=this.configService.options.pages[this._page.component];if(e)return e.name}},enumerable:!0,configurable:!0}),a.prototype.getControlsByPage=function(e){return e?Object.keys(e).filter((function(t){return"object"!=typeof e[t]})).map((function(t,n){return{key:t,value:e[t],schema:"description"===t?"markdown":"text",label:t,placeholder:t,required:!1,order:n+1}})):[]},a.prototype.ngOnInit=function(){var e=this;o.isPlatformBrowser(this.platformId)&&this.pageResolverService.events$.pipe(l.takeUntil(this.unsubscribe)).subscribe((function(t){e.page=t?t.page:null}))},a.prototype.onReset=function(){var e=this;Object.keys(this.form.controls).forEach((function(t){e.form.get(t).setValue(e._pageCopy[t])}))},a.prototype.onSubmit=function(e){this.onAssign(e)},a.prototype.onAssign=function(e){var t=this;Object.keys(this.form.controls).forEach((function(n){switch(n){case"description":t._page[n]=t.markdownService.compile(e[n]);break;default:t._page[n]=e[n]}}))},a.ɵfac=function(e){return new(e||a)(n["ɵɵdirectiveInject"](n.PLATFORM_ID),n["ɵɵdirectiveInject"](c.ConfigService),n["ɵɵdirectiveInject"](t.MarkdownService),n["ɵɵdirectiveInject"](i.FormService),n["ɵɵdirectiveInject"](c.PageResolverService))},a.ɵcmp=n["ɵɵdefineComponent"]({type:a,selectors:[["editor-root-component"]],features:[n["ɵɵInheritDefinitionFeature"]],decls:1,vars:1,consts:[[4,"ngIf"],["name","form","role","form","novalidate","","autocomplete","off",1,"form",3,"formGroup","ngSubmit"],["form","ngForm"],[1,"info"],[1,"id"],[1,"status",3,"ngClass"],[1,"component"],[1,"h1",3,"innerHTML"],[4,"ngFor","ngForOf"],[1,"action-bar"],["type","text","title","Annulla",1,"btn","btn--secondary",3,"disabled","click"],["type","submit","title","Salva",1,"btn","btn--primary",3,"disabled","ngClass"],[3,"option","form"]],template:function(e,t){1&e&&n["ɵɵtemplate"](0,M,21,14,"ng-container",0),2&e&&n["ɵɵproperty"]("ngIf",t.page)},directives:[o.NgIf,r["ɵangular_packages_forms_forms_y"],r.NgControlStatusGroup,r.FormGroupDirective,o.NgClass,o.NgForOf,i.ControlOutletComponent],styles:["[_nghost-%COMP%]{font-family:Arial,Helvetica,sans-serif;font-size:16px;line-height:1.5;background:#fafafa;color:#55555a}.h1[_ngcontent-%COMP%]{color:#55555a;font-size:19px}form[_ngcontent-%COMP%]{margin:0}label[_ngcontent-%COMP%]{display:block;width:100%;color:#55555a;font-weight:700;font-size:12px}.id[_ngcontent-%COMP%]{display:inline-block;padding:4px 6px;background:#0875c2;color:#fff;border-radius:3px;font-size:12px;line-height:1;margin-right:4px}.status[_ngcontent-%COMP%]{display:inline-block;padding:4px 6px;background:#fff;color:#000;border-radius:3px;font-size:12px;line-height:1;margin-right:4px}.status.active[_ngcontent-%COMP%]{background:green;color:#fff}.component[_ngcontent-%COMP%]{display:inline-block;font-size:14px;font-style:italic}"]}),a}(a.DisposableComponent),x=[],k=function(){function e(e){if(e)throw new Error("EditorBundleModule is already loaded. Import it in the AppModule only")}return e.ɵmod=n["ɵɵdefineNgModule"]({type:e}),e.ɵinj=n["ɵɵdefineInjector"]({factory:function(t){return new(t||e)(n["ɵɵinject"](e,12))},providers:f([{provide:"LAZY_ROOT_COMPONENT",useValue:C}],x),imports:[[o.CommonModule,r.FormsModule,r.ReactiveFormsModule,t.MarkdownModule.forRoot({markedOptions:{provide:t.MarkedOptions,useValue:{}}}),a.CoreModule,i.ControlModule]]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&n["ɵɵsetNgModuleScope"](k,{declarations:[C,C],imports:[o.CommonModule,r.FormsModule,r.ReactiveFormsModule,t.MarkdownModule,a.CoreModule,i.ControlModule],exports:[C]});var O=function(){function e(){this.version="0.0.12"}return e.prototype.ngOnInit=function(){},e.ɵfac=function(t){return new(t||e)},e.ɵcmp=n["ɵɵdefineComponent"]({type:e,selectors:[["editor-module"]],decls:2,vars:1,consts:[[1,"editor-module"]],template:function(e,t){1&e&&(n["ɵɵelementStart"](0,"span",0),n["ɵɵtext"](1),n["ɵɵelementEnd"]()),2&e&&(n["ɵɵadvance"](1),n["ɵɵtextInterpolate1"]("editor ",t.version,""))},encapsulation:2}),e}();function w(e,t){1&e&&(n["ɵɵelementContainerStart"](0),n["ɵɵelementContainer"](1,2),n["ɵɵelementContainerEnd"]())}var _=function(e){function t(t,n){var o=e.call(this)||this;return o.platformId=t,o.config=n,o.opened=!1,o}return u(t,e),t.prototype.onKeydown=function(e){"e"===e.key&&e.ctrlKey&&(this.opened=this.config.enabled&&!this.opened,console.log("PanelComponent.document:keydown",this.opened))},t.ɵfac=function(e){return new(e||t)(n["ɵɵdirectiveInject"](n.PLATFORM_ID),n["ɵɵdirectiveInject"](m))},t.ɵcmp=n["ɵɵdefineComponent"]({type:t,selectors:[["panel-component"]],hostBindings:function(e,t){1&e&&n["ɵɵlistener"]("keydown",(function(e){return t.onKeydown(e)}),!1,n["ɵɵresolveDocument"])},features:[n["ɵɵInheritDefinitionFeature"]],decls:2,vars:2,consts:[[1,"panel",3,"clickOutside"],[4,"ngIf"],["bundle","editor"]],template:function(e,t){1&e&&(n["ɵɵelementStart"](0,"div",0),n["ɵɵlistener"]("clickOutside",(function(e){return t.opened=!1})),n["ɵɵtemplate"](1,w,2,0,"ng-container",1),n["ɵɵelementEnd"]()),2&e&&(n["ɵɵproperty"]("@openClose",t.opened?"open":"closed"),n["ɵɵadvance"](1),n["ɵɵproperty"]("ngIf",t.opened))},directives:[o.NgIf,a.BundleDirective],styles:[".panel[_ngcontent-%COMP%]{position:fixed;top:0;right:0;width:320px;height:100vh;padding:15px;overflow-x:hidden;overflow-y:auto;background:#fff;z-index:100000}[_ngcontent-%COMP%]::-webkit-scrollbar{width:0}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:0 0}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:0 0}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:0 0}"],data:{animation:[s.trigger("openClose",[s.state("open",s.style({opacity:1,transform:"translateX(0)"})),s.state("closed",s.style({opacity:.5,transform:"translateX(100%)"})),s.transition("open => closed",[s.animate("250ms")]),s.transition("closed => open",[s.animate("150ms")])])]}}),t}(a.DisposableComponent),S=[v],I=function(){function e(e){if(e)throw new Error("EditorModule is already loaded. Import it in the AppModule only")}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:m,useValue:t}]}},e.ɵmod=n["ɵɵdefineNgModule"]({type:e}),e.ɵinj=n["ɵɵdefineInjector"]({factory:function(t){return new(t||e)(n["ɵɵinject"](e,12))},providers:f(S),imports:[[o.CommonModule,a.CoreModule],a.CoreModule]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&n["ɵɵsetNgModuleScope"](I,{declarations:[O,_],imports:[o.CommonModule,a.CoreModule],exports:[a.CoreModule,O,_]}),Object.defineProperty(e,"MarkdownModule",{enumerable:!0,get:function(){return t.MarkdownModule}}),Object.defineProperty(e,"MarkedOptions",{enumerable:!0,get:function(){return t.MarkedOptions}}),e.EDITOR_CONFIG=m,e.EditorBundleModule=k,e.EditorConfig=g,e.EditorModule=I,e.EditorModuleComponent=O,e.EditorRootComponent=C,e.EditorService=v,e.PanelComponent=_,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=designr-editor.umd.min.js.map