!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/forms"),require("@designr/control"),require("@designr/page"),require("ngx-markdown"),require("rxjs/operators"),require("@angular/common"),require("@angular/animations"),require("@angular/core"),require("@designr/core")):"function"==typeof define&&define.amd?define("@designr/editor",["exports","@angular/forms","@designr/control","@designr/page","ngx-markdown","rxjs/operators","@angular/common","@angular/animations","@angular/core","@designr/core"],t):t((e.designr=e.designr||{},e.designr.editor={}),e.ng.forms,e.control,e.page,e.ngxMarkdown,e.rxjs.operators,e.ng.common,e.ng.animations,e.ng.core,e.core)}(this,function(e,t,o,n,r,i,s,a,c,p){"use strict";var l=new c.InjectionToken("editor.config"),d=function I(e){e&&(this.enabled=e.enabled||!1)},u=function(){function e(e){e=e||{},this.options=new d(e)}return e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:d,decorators:[{type:c.Inject,args:[l]}]}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(l))},token:e,providedIn:"root"}),e}(),f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function g(e,t){function o(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}function m(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i["return"])&&o.call(i)}finally{if(r)throw r.error}}return a}function y(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(m(arguments[t]));return e}var b=function(a){function e(e,t,o,n,r){var i=a.call(this)||this;return i.platformId=e,i.configService=t,i.markdownService=o,i.formService=n,i.pageResolverService=r,i.busy=!1,i.submitted=!1,i}return g(e,a),Object.defineProperty(e.prototype,"page",{get:function(){return this._page},set:function(e){var t=this;this._pageCopy=Object.assign({},e),this._page=e,this._page?(this.options=this.formService.getOptions(this.getControlsByPage(e)),this.form=this.formService.getFormGroup(this.options),this.form.valueChanges.subscribe(function(e){t.onAssign(e)})):(this.options=[],this.form=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentName",{get:function(){if(this._page){var e=this.configService.options.pages[this._page.component];if(e)return e.name}},enumerable:!0,configurable:!0}),e.prototype.getControlsByPage=function(o){return o?Object.keys(o).filter(function(e){return"object"!=typeof o[e]}).map(function(e,t){return{key:e,value:o[e],schema:"description"===e?"markdown":"text",label:e,placeholder:e,required:!1,order:t+1}}):[]},e.prototype.ngOnInit=function(){var t=this;s.isPlatformBrowser(this.platformId)&&this.pageResolverService.events$.pipe(i.takeUntil(this.unsubscribe)).subscribe(function(e){t.page=e?e.page:null})},e.prototype.onReset=function(){var t=this;Object.keys(this.form.controls).forEach(function(e){t.form.get(e).setValue(t._pageCopy[e])})},e.prototype.onSubmit=function(e){this.onAssign(e)},e.prototype.onAssign=function(t){var o=this;Object.keys(this.form.controls).forEach(function(e){switch(e){case"description":o._page[e]=o.markdownService.compile(t[e]);break;default:o._page[e]=t[e]}})},e.decorators=[{type:c.Component,args:[{selector:"editor-root-component",template:'<ng-container *ngIf="page">\r\n\t<form class="form" name="form" [formGroup]="form" (ngSubmit)="form.valid && onSubmit(form.value)" #form="ngForm" role="form" novalidate autocomplete="off">\r\n\t\t<div class="info">\r\n\t\t\t<span class="id">{{page.id}}</span>\r\n\t\t\t<span class="status" [ngClass]="{ active: page.active }">{{page.active ? \'active\' : \'inactive\'}}</span>\r\n\t\t\t<span class="component">{{componentName}}</span>\r\n\t\t</div>\r\n\t\t<hr>\r\n\t\t<h2 class="h1" [innerHTML]="page.title"></h2>\r\n\t\t\x3c!--\r\n\t\t\t\t<p [innerHTML]="page.description"></p>\r\n\t\t\t\t--\x3e\r\n\t\t<hr>\r\n\t\t<div *ngFor="let option of options">\r\n\t\t\t<control-outlet class="fieldset__field fieldset__field--{{option.schema}}" [option]="option" [form]="form"></control-outlet>\r\n\t\t</div>\r\n\t\t\x3c!-- <control-editable formControlName="email"></control-editable> --\x3e\r\n\t\t<div class="action-bar">\r\n\t\t\t<button type="text" class="btn btn--secondary" [disabled]="submitted || !form.valid" (click)="onReset()" title="Annulla"><span>Annulla</span></button>\r\n\t\t\t<button type="submit" class="btn btn--primary" [disabled]="submitted || !form.valid" [ngClass]="{ \'btn--busy\': busy }" title="Salva"><span>Salva</span></button>\r\n\t\t</div>\r\n\t</form>\r\n</ng-container>\r\n',encapsulation:c.ViewEncapsulation.Emulated,styles:[":host{font-family:Arial,Helvetica,sans-serif;font-size:16px;line-height:1.5;background:#fafafa;color:#55555a}.h1{color:#55555a;font-size:19px}form{margin:0}label{display:block;width:100%;color:#55555a;font-weight:700;font-size:12px}.id{display:inline-block;padding:4px 6px;background:#0875c2;color:#fff;border-radius:3px;font-size:12px;line-height:1;margin-right:4px}.status{display:inline-block;padding:4px 6px;background:#fff;color:#000;border-radius:3px;font-size:12px;line-height:1;margin-right:4px}.status.active{background:green;color:#fff}.component{display:inline-block;font-size:14px;font-style:italic}"]}]}],e.ctorParameters=function(){return[{type:String,decorators:[{type:c.Inject,args:[c.PLATFORM_ID]}]},{type:n.ConfigService},{type:r.MarkdownService},{type:o.FormService},{type:n.PageResolverService}]},e}(p.DisposableComponent),h=[],v=[b],k={},w=b,x=function(){function e(e){if(e)throw new Error("EditorBundleModule is already loaded. Import it in the AppModule only")}return e.decorators=[{type:c.NgModule,args:[{imports:[s.CommonModule,t.FormsModule,t.ReactiveFormsModule,r.MarkdownModule.forRoot({markedOptions:{provide:r.MarkedOptions,useValue:k}}),p.CoreModule,o.ControlModule],providers:y([{provide:"LAZY_ROOT_COMPONENT",useValue:w}],h),declarations:y([b],v),entryComponents:[b],exports:y(v)}]}],e.ctorParameters=function(){return[{type:e,decorators:[{type:c.Optional},{type:c.SkipSelf}]}]},e}(),M=function(){function e(){this.version="0.0.13"}return e.prototype.ngOnInit=function(){},e.decorators=[{type:c.Component,args:[{selector:"editor-module",template:'<span class="editor-module">editor {{version}}</span>'}]}],e.ctorParameters=function(){return[]},e}(),C=function(n){function e(e,t){var o=n.call(this)||this;return o.platformId=e,o.config=t,o.opened=!1,o}return g(e,n),e.prototype.onKeydown=function(e){"e"===e.key&&e.ctrlKey&&(this.opened=this.config.enabled&&!this.opened,console.log("PanelComponent.document:keydown",this.opened))},e.decorators=[{type:c.Component,args:[{selector:"panel-component",template:'<div class="panel" [@openClose]="opened ? \'open\' : \'closed\'" (clickOutside)="opened = false">\r\n\t<ng-container *ngIf="opened">\r\n\t\t<ng-container bundle="editor"></ng-container>\r\n\t</ng-container>\r\n</div>\r\n',animations:[a.trigger("openClose",[a.state("open",a.style({opacity:1,transform:"translateX(0)"})),a.state("closed",a.style({opacity:.5,transform:"translateX(100%)"})),a.transition("open => closed",[a.animate("250ms")]),a.transition("closed => open",[a.animate("150ms")])])],encapsulation:c.ViewEncapsulation.Emulated,styles:[".panel{position:fixed;top:0;right:0;width:320px;height:100vh;padding:15px;overflow-x:hidden;overflow-y:auto;background:#fff;z-index:100000}::-webkit-scrollbar{width:0}::-webkit-scrollbar-track{background:0 0}::-webkit-scrollbar-thumb{background:0 0}::-webkit-scrollbar-thumb:hover{background:0 0}"]}]}],e.ctorParameters=function(){return[{type:String,decorators:[{type:c.Inject,args:[c.PLATFORM_ID]}]},{type:d,decorators:[{type:c.Inject,args:[l]}]}]},e.propDecorators={onKeydown:[{type:c.HostListener,args:["document:keydown",["$event"]]}]},e}(p.DisposableComponent),O=[u],_=[M,C],S=[],j=function(){function t(e){if(e)throw new Error("EditorModule is already loaded. Import it in the AppModule only")}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:l,useValue:e}]}},t.decorators=[{type:c.NgModule,args:[{imports:[s.CommonModule,p.CoreModule],providers:y(O),declarations:y(_,S),exports:y([p.CoreModule],_)}]}],t.ctorParameters=function(){return[{type:t,decorators:[{type:c.Optional},{type:c.SkipSelf}]}]},t}();e.MarkdownModule=r.MarkdownModule,e.MarkedOptions=r.MarkedOptions,e.EditorConfig=d,e.EDITOR_CONFIG=l,e.EditorService=u,e.EditorBundleModule=x,e.EditorRootComponent=b,e.EditorModuleComponent=M,e.EditorModule=j,e.Éµa=C,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=designr-editor.umd.min.js.map