!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/forms"),require("@designr/control"),require("@designr/page"),require("ngx-markdown"),require("rxjs/operators"),require("@angular/common"),require("@angular/animations"),require("@angular/core"),require("@designr/core")):"function"==typeof define&&define.amd?define("@designr/editor",["exports","@angular/forms","@designr/control","@designr/page","ngx-markdown","rxjs/operators","@angular/common","@angular/animations","@angular/core","@designr/core"],e):e((t.designr=t.designr||{},t.designr.editor={}),t.ng.forms,t.control,t.page,t.ngxMarkdown,t.rxjs.operators,t.ng.common,t.ng.animations,t.ng.core,t.core)}(this,function(t,e,o,n,r,i,s,a,l,c){"use strict";var p=new l.InjectionToken("editor.config"),d=function j(t){t&&(this.enabled=t.enabled||!1)},u=function(){function t(t){t=t||{},this.options=new d(t)}return t.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:d,decorators:[{type:l.Inject,args:[p]}]}]},t.ngInjectableDef=l.defineInjectable({factory:function(){return new t(l.inject(p))},token:t,providedIn:"root"}),t}(),f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};function g(t,e){function o(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}function m(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)a.push(n.value)}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i["return"])&&o.call(i)}finally{if(r)throw r.error}}return a}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(m(arguments[e]));return t}var b=function(a){function t(t,e,o,n,r){var i=a.call(this)||this;return i.platformId=t,i.pageService=e,i.markdownService=o,i.formService=n,i.pageResolverService=r,i.busy=!1,i.submitted=!1,i}return g(t,a),Object.defineProperty(t.prototype,"page",{get:function(){return this._page},set:function(t){var e=this;this._pageCopy=Object.assign({},t),this._page=t,this._page?(this.controls=this.formService.getControlsFromOptions(this.getControlsByPage(t)),this.group=this.formService.getGroupFromControls(this.controls),this.group.valueChanges.subscribe(function(t){e.onAssign(t)})):(this.controls=[],this.group=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentName",{get:function(){if(this._page){var t=this.pageService.options.pages[this._page.component];if(t)return t.name}},enumerable:!0,configurable:!0}),t.prototype.getControlsByPage=function(o){return o?Object.keys(o).filter(function(t){return"object"!=typeof o[t]}).map(function(t,e){return{key:t,value:o[t],schema:"description"===t?"markdown":"text",label:t,placeholder:t,required:!1,order:e+1}}):[]},t.prototype.ngOnInit=function(){var e=this;s.isPlatformBrowser(this.platformId)&&this.pageResolverService.events$.pipe(i.takeUntil(this.unsubscribe)).subscribe(function(t){e.page=t?t.page:null})},t.prototype.onReset=function(){var e=this;Object.keys(this.group.controls).forEach(function(t){e.group.get(t).setValue(e._pageCopy[t])})},t.prototype.onSubmit=function(t){this.onAssign(t)},t.prototype.onAssign=function(e){var o=this;Object.keys(this.group.controls).forEach(function(t){switch(t){case"description":o._page[t]=o.markdownService.compile(e[t]);break;default:o._page[t]=e[t]}})},t.decorators=[{type:l.Component,args:[{selector:"editor-root-component",template:'<ng-container *ngIf="page">\n\t<form class="form" name="group" [formGroup]="group" (ngSubmit)="group.valid && onSubmit(group.value)" #form="ngForm" role="form" novalidate autocomplete="off">\n\t\t<div class="info">\n\t\t\t<span class="id">{{page.id}}</span>\n\t\t\t<span class="status" [ngClass]="{ active: page.active }">{{page.active ? \'active\' : \'inactive\'}}</span>\n\t\t\t<span class="component">{{componentName}}</span>\n\t\t</div>\n\t\t<hr>\n\t\t<h2 class="h1" [innerHTML]="page.title"></h2>\n\t\t\x3c!--\n\t\t\t\t<p [innerHTML]="page.description"></p>\n\t\t\t\t--\x3e\n\t\t<hr>\n\t\t\x3c!--\n\t\t\t\t<div class="fieldset">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<label>Label</label>\n\t\t\t\t\t\t<input placeholder="placeholder" type="text" class="form-control" required [(ngModel)]="model.title" name="title" #title="ngModel" autocomplete="title">\n\t\t\t\t\t\t<div *ngIf="title.invalid && (form.submitted || title.dirty || title.touched)" class="alert alert--danger">\n\t\t\t\t\t\t\t<div *ngIf="title.errors.required">{{ \'errors.required\' | translate }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t--\x3e\n\t\t<div *ngFor="let control of controls">\n\t\t\t<control-outlet class="form-group" [control]="control" [form]="group"></control-outlet>\n\t\t</div>\n\t\t\x3c!-- <control-editable formControlName="email"></control-editable> --\x3e\n\t\t<div class="action-bar">\n\t\t\t<button type="text" class="btn btn--secondary" [disabled]="submitted || !group.valid" (click)="onReset()" title="Annulla"><span>Annulla</span></button>\n\t\t\t<button type="submit" class="btn btn--primary" [disabled]="submitted || !group.valid" [ngClass]="{ \'btn--busy\': busy }" title="Salva"><span>Salva</span></button>\n\t\t</div>\n\t</form>\n</ng-container>\n',encapsulation:l.ViewEncapsulation.Emulated,styles:[":host{font-family:Arial,Helvetica,sans-serif;font-size:16px;line-height:1.5;background:#fafafa;color:#55555a}.h1{color:#55555a;font-size:19px}form{margin:0}label{display:block;width:100%;color:#55555a;font-weight:700;font-size:12px}.id{display:inline-block;padding:4px 6px;background:#0875c2;color:#fff;border-radius:3px;font-size:12px;line-height:1;margin-right:4px}.status{display:inline-block;padding:4px 6px;background:#fff;color:#000;border-radius:3px;font-size:12px;line-height:1;margin-right:4px}.status.active{background:green;color:#fff}.component{display:inline-block;font-size:14px;font-style:italic}"]}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:l.Inject,args:[l.PLATFORM_ID]}]},{type:n.PageService},{type:r.MarkdownService},{type:o.FormService},{type:n.PageResolverService}]},t}(c.DisposableComponent),h=[],v=[b],k={},x=b,w=function(){function t(t){if(t)throw new Error("EditorBundleModule is already loaded. Import it in the AppModule only")}return t.decorators=[{type:l.NgModule,args:[{imports:[s.CommonModule,e.FormsModule,e.ReactiveFormsModule,r.MarkdownModule.forRoot({markedOptions:{provide:r.MarkedOptions,useValue:k}}),c.CoreModule,o.ControlModule],providers:y([{provide:"LAZY_ROOT_COMPONENT",useValue:x}],h),declarations:y([b],v),entryComponents:[b],exports:y(v)}]}],t.ctorParameters=function(){return[{type:t,decorators:[{type:l.Optional},{type:l.SkipSelf}]}]},t}(),M=function(){function t(){this.version="0.0.3"}return t.prototype.ngOnInit=function(){},t.decorators=[{type:l.Component,args:[{selector:"editor-module",template:'<span class="editor-module">editor {{version}}</span>'}]}],t.ctorParameters=function(){return[]},t}(),C=function(n){function t(t,e){var o=n.call(this)||this;return o.platformId=t,o.config=e,o.opened=!1,o}return g(t,n),t.prototype.onKeydown=function(t){"e"===t.key&&t.ctrlKey&&(this.opened=this.config.enabled&&!this.opened,console.log("PanelComponent.document:keydown",this.opened))},t.decorators=[{type:l.Component,args:[{selector:"panel-component",template:'<div class="panel" [@openClose]="opened ? \'open\' : \'closed\'" (clickOutside)="opened = false">\n\t<ng-container *ngIf="opened">\n\t\t<ng-container bundle="editor"></ng-container>\n\t</ng-container>\n</div>\n',animations:[a.trigger("openClose",[a.state("open",a.style({opacity:1,transform:"translateX(0)"})),a.state("closed",a.style({opacity:.5,transform:"translateX(100%)"})),a.transition("open => closed",[a.animate("250ms")]),a.transition("closed => open",[a.animate("150ms")])])],encapsulation:l.ViewEncapsulation.Emulated,styles:[".panel{position:fixed;top:0;right:0;width:320px;height:100vh;padding:15px;overflow-x:hidden;overflow-y:auto;background:#fff;z-index:100000}::-webkit-scrollbar{width:0}::-webkit-scrollbar-track{background:0 0}::-webkit-scrollbar-thumb{background:0 0}::-webkit-scrollbar-thumb:hover{background:0 0}"]}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:l.Inject,args:[l.PLATFORM_ID]}]},{type:d,decorators:[{type:l.Inject,args:[p]}]}]},t.propDecorators={onKeydown:[{type:l.HostListener,args:["document:keydown",["$event"]]}]},t}(c.DisposableComponent),O=[u],S=[M,C],I=[],_=function(){function e(t){if(t)throw new Error("EditorModule is already loaded. Import it in the AppModule only")}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:p,useValue:t}]}},e.decorators=[{type:l.NgModule,args:[{imports:[s.CommonModule,c.CoreModule],providers:y(O),declarations:y(S,I),exports:y([c.CoreModule],S)}]}],e.ctorParameters=function(){return[{type:e,decorators:[{type:l.Optional},{type:l.SkipSelf}]}]},e}();t.MarkdownModule=r.MarkdownModule,t.MarkedOptions=r.MarkedOptions,t.EditorConfig=d,t.EDITOR_CONFIG=p,t.EditorService=u,t.EditorBundleModule=w,t.EditorRootComponent=b,t.EditorModuleComponent=M,t.EditorModule=_,t.Éµa=C,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=designr-editor.umd.min.js.map