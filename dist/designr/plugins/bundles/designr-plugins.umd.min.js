!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common/http"),require("@angular/router"),require("@angular/common"),require("@angular/core"),require("@designr/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@designr/plugins",["exports","@angular/common/http","@angular/router","@angular/common","@angular/core","@designr/core","rxjs","rxjs/operators"],e):e((t.designr=t.designr||{},t.designr.plugins={}),t.ng.common.http,t.ng.router,t.ng.common,t.ng.core,t.core,t.rxjs,t.rxjs.operators)}(this,function(t,e,o,i,s,n,a,c){"use strict";var r=function L(t){this.origin="",console.log("PluginsConfig",t),t&&Object.assign(this,t)},p=new s.InjectionToken("plugin.config"),u=function(){function t(t){console.log("PluginsService",t),t=t||{},this.options=new r(t)}return t.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:r,decorators:[{type:s.Inject,args:[p]}]}]},t.ngInjectableDef=s.defineInjectable({factory:function(){return new t(s.inject(p))},token:t,providedIn:"root"}),t}(),l=function(){function t(){this.version="0.0.1"}return t.prototype.ngOnInit=function(){},t.decorators=[{type:s.Component,args:[{selector:"plugins-module",template:'<span class="plugins-module">plugins {{version}}</span>'}]}],t.ctorParameters=function(){return[]},t}(),g=function x(){this.fields="id,name,first_name,last_name,email,gender,picture,cover,link",this.scope="public_profile, email",this.version="v2.10"},f=function(){function t(t,e,n,o,i){this.platformId=t,this.pluginsService=e,this.storageService=n,this.onceService=o,this.routeService=i,this.init()}return t.prototype.init=function(){if(!this.pluginsService.options&&!this.pluginsService.options.facebook)throw new Error("FacebookService.error missing config object in environment.plugins.facebook");this.options=Object.assign(new g,this.pluginsService.options.facebook),this.storage=this.storageService.tryGet(),this.authResponse=this.storage.get("facebook")},t.prototype.facebook=function(){var n=this;return i.isPlatformBrowser(this.platformId)&&-1!==window.location.protocol.indexOf("https")?this.FB?a.of(this.FB):this.onceService.script("//connect.facebook.net/"+this.routeService.currentLang+"/sdk.js","fbAsyncInit").pipe(c.concatMap(function(t){var e=window.FB;return e.init({appId:n.options.appId,cookie:!0,xfbml:!0,version:n.options.version}),n.FB=e,a.of(e)})):a.of(null)},t.prototype.status=function(){var o=this;return this.facebook().pipe(c.filter(function(t){return null!==t}),c.concatMap(function(t){return a.from(new Promise(function(e,n){t.getLoginStatus(function(t){o.authResponse=null,"connected"===t.status?(o.authResponse=t.authResponse,o.storage.set("facebook",t.authResponse),e(t)):("not_authorized"===t.status&&o.storage["delete"]("facebook"),n(t))},{scope:o.options.scope})}))}))},t.prototype.login=function(){var o=this;return this.facebook().pipe(c.filter(function(t){return null!==t}),c.concatMap(function(t){return a.from(new Promise(function(e,n){t.login(function(t){o.authResponse=null,"connected"===t.status?(o.authResponse=t.authResponse,o.storage.set("facebook",t.authResponse),e(t)):("not_authorized"===t.status&&o.storage["delete"]("facebook"),n(t))},{scope:o.options.scope})}))}))},t.prototype.logout=function(){var o=this;return this.facebook().pipe(c.filter(function(t){return null!==t}),c.concatMap(function(n){return a.from(new Promise(function(e,t){n.logout(function(t){e(t),o.storage["delete"]("facebook")})}))}))},t.prototype.getMe=function(e){var r=this;return this.login().pipe(c.concatMap(function(t){return a.from(new Promise(function(o,i){e=e||r.options.fields,r.FB.api("/me",{fields:e,accessToken:r.options.tokenClient},function(t){if(!t||t.error){var e=t?t.error:"error";console.log("FacebookService.getMe.error",e),i(t.error)}else{var n=t;n.authResponse=r.authResponse,n.facebookToken=r.authResponse.accessToken,o(n)}})}))}))},t.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:s.Inject,args:[s.PLATFORM_ID]}]},{type:u},{type:n.LocalStorageService},{type:n.OnceService},{type:n.RouteService}]},t.ngInjectableDef=s.defineInjectable({factory:function(){return new t(s.inject(s.PLATFORM_ID),s.inject(u),s.inject(n.LocalStorageService),s.inject(n.OnceService),s.inject(n.RouteService))},token:t,providedIn:"root"}),t}(),h=function(t,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function d(t,e){function n(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var m=function A(){},y=function C(){},v=function(){function t(t,e,n,o,i){this.platformId=t,this.pluginsService=e,this.zone=n,this.onceService=o,this.logger=i,this.init()}return t.prototype.init=function(){if(!this.pluginsService.options&&!this.pluginsService.options.googleTagManager)throw new Error("GoogleTagManagerService.error missing config object in environment.plugins.googleTagManager");this.options=Object.assign(new y,this.pluginsService.options.googleTagManager)},t.prototype.once=function(){var e=this;if(i.isPlatformBrowser(this.platformId)){if(this.dataLayer)return a.of(this.dataLayer);if(this.dataLayer$)return this.dataLayer$;window.dataLayer=window.dataLayer||[];var t="https://www.googletagmanager.com/gtm.js?id="+this.options.id,n=window.dataLayer;return n.push({"gtm.start":(new Date).getTime(),event:"gtm.js"}),this.dataLayer$=this.onceService.script(t).pipe(c.map(function(t){return e.dataLayer=n})),this.dataLayer$}return a.of(null)},t.prototype.push=function(e){var n=this;this.zone.runOutsideAngular(function(){n.dataLayer?(n.dataLayer.push(e),n.logger.log("GoogleTagManagerConfig.push",e)):n.once().pipe(c.first()).subscribe(function(t){n.dataLayer&&(n.dataLayer.push(e),n.logger.log("GoogleTagManagerConfig.push",e))})})},t.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:s.Inject,args:[s.PLATFORM_ID]}]},{type:u},{type:s.NgZone},{type:n.OnceService},{type:n.Logger}]},t.ngInjectableDef=s.defineInjectable({factory:function(){return new t(s.inject(s.PLATFORM_ID),s.inject(u),s.inject(s.NgZone),s.inject(n.OnceService),s.inject(n.Logger))},token:t,providedIn:"root"}),t}(),b=function(r){function t(t,e,n,o){var i=r.call(this)||this;return i.platformId=t,i.pluginsService=e,i.router=n,i.googleTagManager=o,i.useIframe=!0,i.pageView=new s.EventEmitter,i}return d(t,r),t.prototype.ngAfterViewInit=function(){var n=this;i.isPlatformBrowser(this.platformId)&&this.router.events.pipe(c.takeUntil(this.unsubscribe),c.filter(function(t){return t instanceof o.NavigationEnd})).subscribe(function(t){var e=""+n.pluginsService.options.origin+t.urlAfterRedirects;n.dataLayer?n.pageView.emit({dataLayer:n.dataLayer,url:e}):n.googleTagManager.once().pipe(c.takeUntil(n.unsubscribe)).subscribe(function(t){n.id=n.googleTagManager.options.id,n.iframeUrl="https://www.googletagmanager.com/ns.html?id="+n.id,n.dataLayer=t,n.pageView.emit({dataLayer:n.dataLayer,url:e})})})},t.decorators=[{type:s.Component,args:[{selector:"core-google-tag-manager",template:'\n\t\x3c!-- Google Tag Manager (noscript) --\x3e\n\t\t<noscript *ngIf="useIframe && dataLayer">\n\t\t\t<iframe [src]="iframeUrl | safeUrl" height="0" width="0" style="display:none;visibility:hidden"></iframe>\n\t\t</noscript>\n\t\x3c!-- End Google Tag Manager (noscript) --\x3e'}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:s.Inject,args:[s.PLATFORM_ID]}]},{type:u},{type:o.Router},{type:v}]},t.propDecorators={pageView:[{type:s.Output}]},t}(n.DisposableComponent),w=function E(){this.cookiepolicy="single_host_origin",this.scope="profile email",this.fetch_basic_profile=!0,this.ux_mode="popup"},I=function(){function t(t,e,n,o){this.platformId=t,this.pluginsService=e,this.storageService=n,this.onceService=o,this.init()}return t.prototype.init=function(){if(!this.pluginsService.options&&!this.pluginsService.options.google)throw new Error("GoogleService.error missing config object in environment.plugins.google");this.options=Object.assign(new w,this.pluginsService.options.google),this.storage=this.storageService.tryGet(),this.authResponse=this.storage.get("google")},t.prototype.google=function(){var e=this;return i.isPlatformBrowser(this.platformId)?(new a.Observable).pipe(function(t){return e.gapi?a.of(e.gapi):e.once()}):a.of(null)},t.prototype.getMe=function(){var o=this;return this.login().pipe(c.concatMap(function(t){var e=o.instance.currentUser.get().getBasicProfile(),n={id:e.getId(),name:e.getName(),firstName:e.getGivenName(),lastName:e.getFamilyName(),picture:e.getImageUrl(),email:e.getEmail(),authResponse:o.authResponse,googleToken:o.authResponse.access_token};return a.of(n)}))},t.prototype.login=function(){var e=this;return this.auth2Instance().pipe(c.concatMap(function(t){return e.signin()}))},t.prototype.logout=function(){var n=this;return this.auth2Instance().pipe(c.concatMap(function(t){return a.from(new Promise(function(e,t){n.instance.isSignedIn&&n.instance.isSignedIn.get()?n.instance.signOut().then(function(t){e()},t):e()}))}))},t.prototype.once=function(){var e=this;return this.onceService.script("https://apis.google.com/js/api:client.js?onload={{callback}}",!0).pipe(c.concatMap(function(t){return e.gapi=window.gapi,a.of(e.gapi)}))},t.prototype.getAuth2=function(){var n=this;return(new a.Observable).pipe(function(t){return n.auth2?a.of(n.auth2):n.google().pipe(c.concatMap(function(t){return n.gapi.auth2?n.auth2init():a.from(new Promise(function(t,e){n.gapi.load("auth2",function(){setTimeout(function(){t()},200)},e)})).pipe(c.concatMap(function(t){return n.auth2init()}))}))})},t.prototype.signin=function(){var i=this;return a.from(new Promise(function(n,o){var e=function(){try{var t=i.instance.currentUser.get().getAuthResponse(!0);i.authResponse=t,i.storage.set("google",t),n({code:t.access_token})}catch(e){console.log("GoogleLogin.readAccessToken.error",e),i.storage["delete"]("google"),o(e)}};i.instance.isSignedIn&&i.instance.isSignedIn.get()?e():i.instance.signIn({scope:"profile email"}).then(function(t){e()},function(t){i.storage["delete"]("google"),o(t)})}))},t.prototype.auth2init=function(){var n=this;return a.from(new Promise(function(t,e){n.gapi.auth2.init({client_id:n.options.clientId,cookiepolicy:"single_host_origin",scope:"profile email",fetch_basic_profile:!0,ux_mode:"popup"}).then(function(){n.auth2=n.gapi.auth2,t(n.auth2)},e)}))},t.prototype.auth2Instance=function(){var e=this;return this.instance?a.of(this.instance):this.getAuth2().pipe(c.concatMap(function(t){return e.instance=e.auth2.getAuthInstance(),a.of(e.instance)}))},t.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:s.Inject,args:[s.PLATFORM_ID]}]},{type:u},{type:n.LocalStorageService},{type:n.OnceService}]},t.ngInjectableDef=s.defineInjectable({factory:function(){return new t(s.inject(s.PLATFORM_ID),s.inject(u),s.inject(n.LocalStorageService),s.inject(n.OnceService))},token:t,providedIn:"root"}),t}(),S=function(){function t(){}return t.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=s.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),j=function D(){},P=function(){function t(t,e,n){this.platformId=t,this.pluginsService=e,this.onceService=n,this.init()}return t.prototype.init=function(){if(!this.pluginsService.options&&!this.pluginsService.options.paypal)throw new Error("PayPalService.error missing config object in environment.plugins.paypal");this.options=Object.assign(new j,this.pluginsService.options.paypal)},t.prototype.once=function(){var e=this;if(i.isPlatformBrowser(this.platformId)){if(this.paypal)return a.of(this.paypal);if(this.paypal$)return this.paypal$;return this.paypal$=this.onceService.script("https://www.paypalobjects.com/api/checkout.js").pipe(c.map(function(t){return e.paypal=window.paypal,e.paypal})),this.paypal$}return a.of(null)},t.prototype.render=function(e,n){var o=this;return n=n||"#paypal-button",this.once().pipe(c.mergeMap(function(t){return t.Button.render(o.getOptions(t,e),n),a.of(t)}))},t.prototype.getOptions=function(e,i){var t=Object.assign(this.options,i);return t.payment=function(t,o){return new e.Promise(function(e,n){i.payment?i.payment().pipe(c.first(),c.mergeMap(function(t){return a.from(o.payment.create(t))})).subscribe(function(t){return e(t)},function(t){return n(t)}):(console.log("PayPalService.payment callback not setted"),n(null))})},t.onAuthorize=function(t,e){if(i.onAuthorize)return e.payment.execute().then(function(t){return i.onAuthorize(t,null)},function(t){return i.onAuthorize(null,t)});console.log("PayPalService.onAuthorize callback not setted")},t},t.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:s.Inject,args:[s.PLATFORM_ID]}]},{type:u},{type:n.OnceService}]},t.ngInjectableDef=s.defineInjectable({factory:function(){return new t(s.inject(s.PLATFORM_ID),s.inject(u),s.inject(n.OnceService))},token:t,providedIn:"root"}),t}(),T=function(o){function t(t,e){var n=o.call(this)||this;return n.platformId=t,n.paypalService=e,n}return d(t,o),t.prototype.ngAfterViewInit=function(){i.isPlatformBrowser(this.platformId)&&this.paypalService.render(this.paypalOptions,"#paypal-widget-button").pipe(c.takeUntil(this.unsubscribe)).subscribe(function(t){})},t.decorators=[{type:s.Component,args:[{selector:"plugins-paypal-widget-component",template:'<div id="#paypal-widget-button"></div>'}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:s.Inject,args:[s.PLATFORM_ID]}]},{type:P}]},t.propDecorators={paypalOptions:[{type:s.Input}]},t}(n.DisposableComponent),M=function F(){this.businessunitId="58e253ab0000ff00059fc0fe",this.businessunitName="www.eurospin-viaggi.it"},k=function(){function t(t,e,n){this.platformId=t,this.pluginsService=e,this.onceService=n,this.init()}return t.prototype.init=function(){if(!this.pluginsService.options&&!this.pluginsService.options.trustPilot)throw new Error("TrustPilotService.error missing config object in environment.plugins.trustPilot");this.options=Object.assign(new M,this.pluginsService.options.trustPilot)},t.prototype.once=function(){var e=this;if(i.isPlatformBrowser(this.platformId)){if(this.Trustpilot)return a.of(this.Trustpilot);if(this.Trustpilot$)return this.Trustpilot$;return this.Trustpilot$=this.onceService.script("https://widget.trustpilot.com/bootstrap/v5/tp.widget.bootstrap.min.js").pipe(c.map(function(t){return e.Trustpilot=window.Trustpilot,e.Trustpilot})),this.Trustpilot$}return a.of(null)},t.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:s.Inject,args:[s.PLATFORM_ID]}]},{type:u},{type:n.OnceService}]},t.ngInjectableDef=s.defineInjectable({factory:function(){return new t(s.inject(s.PLATFORM_ID),s.inject(u),s.inject(n.OnceService))},token:t,providedIn:"root"}),t}(),O=function(){function e(t){this.locale="it-IT",this.styleHeight="350px",this.styleWidth="100%",this.theme="light",this.group="on",this.stars="1,2,3,4,5",t&&Object.assign(this,t)}return e.newFromConfig=function(t){return new e(t)},e.prototype.set=function(t){return t&&Object.assign(this,t),this},e}(),_=function(r){function t(t,e,n,o){var i=r.call(this)||this;return i.platformId=t,i.pluginsService=e,i.elementRef=n,i.trustPilot=o,i.init(),i}return d(t,r),t.prototype.init=function(){if(!this.pluginsService.options&&!this.pluginsService.options.trustPilot)throw new Error("TrustPilotService.error missing config object in environment.plugins.trustPilot");this.trustPilotOptions=this.pluginsService.options.trustPilot,this.options=new O(this.trustPilotOptions)},t.prototype.ngAfterViewInit=function(){var e=this;i.isPlatformBrowser(this.platformId)&&this.elementRef.nativeElement.children.length&&(this.loaded||this.trustPilot.once().pipe(c.takeUntil(this.unsubscribe)).subscribe(function(t){t.loadFromElement(e.elementRef.nativeElement.firstElementChild),e.loaded=!0}))},t.decorators=[{type:s.Component,args:[{selector:"plugins-trustpilot-widget-component",template:'<ng-container>\n\t<ng-container [ngSwitch]="options.templateId">\n\t\t<ng-container *ngSwitchCase="\'544a426205dc0a09088833c6\'">\n\t\t\t\x3c!-- PRODUCT REVIEWS --\x3e\n\t\t\t<div class="trustpilot-comments">\n\t\t\t\t<div class="trustpilot-widget" [attr.data-template-id]="options.templateId" [attr.data-businessunit-id]="options.businessunitId" [attr.data-locale]="options.locale" [attr.data-style-height]="options.styleHeight" [attr.data-style-width]="options.styleWidth" [attr.data-theme]="options.theme" [attr.data-sku]="sku" style="margin: 30px 0; max-width: 750px;">\n\t\t\t\t\t<a href="https://it.trustpilot.com/review/{{options.businessunitName}}" target="_blank">Trustpilot</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ng-container>\n\t\t<ng-container *ngSwitchCase="\'530d0eaf748a510e2093cf9b\'">\n\t\t\t\x3c!-- EVALUATE --\x3e\n\t\t\t<div class="trustpilot-widget" [attr.data-template-id]="options.templateId" [attr.data-businessunit-id]="options.businessunitId" [attr.data-locale]="options.locale" [attr.data-style-height]="options.styleHeight" [attr.data-style-width]="options.styleWidth" [attr.data-theme]="options.theme" [attr.data-group]="options.group" style="margin: 30px 0; max-width: 750px;">\n\t\t\t\t<a href="https://it.trustpilot.com/review/{{options.businessunitName}}" target="_blank">Trustpilot</a>\n\t\t\t</div>\n\t\t</ng-container>\n\t\t<ng-container *ngSwitchCase="\'53aa8807dec7e10d38f59f32\'">\n\t\t\t\x3c!-- MINI --\x3e\n\t\t\t<div class="trustpilot-widget" [attr.data-template-id]="options.templateId" [attr.data-businessunit-id]="options.businessunitId" [attr.data-locale]="options.locale" [attr.data-style-height]="options.styleHeight" [attr.data-style-width]="options.styleWidth" [attr.data-theme]="options.theme" style="margin: 15px auto; max-width: 750px;">\n\t\t\t\t<a href="https://it.trustpilot.com/review/{{options.businessunitName}}" target="_blank">Trustpilot</a>\n\t\t\t</div>\n\t\t</ng-container>\n\t\t<ng-container *ngSwitchCase="\'5613c9cde69ddc09340c6beb\'">\n\t\t\t\x3c!-- STARTER --\x3e\n\t\t\t<div class="trustpilot-widget" [attr.data-template-id]="options.templateId" [attr.data-businessunit-id]="options.businessunitId" [attr.data-locale]="options.locale" [attr.data-style-height]="options.styleHeight" [attr.data-style-width]="options.styleWidth" [attr.data-theme]="options.theme" style="margin: 15px auto; max-width: 750px;">\n\t\t\t\t<a href="https://it.trustpilot.com/review/{{options.businessunitName}}" target="_blank">Trustpilot</a>\n\t\t\t</div>\n\t\t</ng-container>\n\t\t<ng-container *ngSwitchCase="\'53aa8912dec7e10d38f59f36\'">\n\t\t\t\x3c!-- CAROUSEL --\x3e\n\t\t\t<div class="trustpilot-widget" [attr.data-template-id]="options.templateId" [attr.data-businessunit-id]="options.businessunitId" [attr.data-locale]="options.locale" [attr.data-style-height]="options.styleHeight" [attr.data-style-width]="options.styleWidth" [attr.data-theme]="options.theme" [attr.data-stars]="options.stars" style="margin: 15px auto;">\n\t\t\t\t<a href="https://it.trustpilot.com/review/{{options.businessunitName}}" target="_blank">Trustpilot</a>\n\t\t\t</div>\n\t\t</ng-container>\n\t</ng-container>\n</ng-container>\n',encapsulation:s.ViewEncapsulation.Emulated,styles:[":host{width:100%}.trustpilot-widget{margin:15px auto!important}@media print{.trustpilot-comments{display:none!important}}"]}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:s.Inject,args:[s.PLATFORM_ID]}]},{type:u},{type:s.ElementRef},{type:k}]},t.propDecorators={options:[{type:s.Input}],sku:[{type:s.Input}]},t}(n.DisposableComponent),R=function(){function t(t){if(t)throw new Error("PluginsModule is already loaded. Import it in the AppModule only")}return t.decorators=[{type:s.NgModule,args:[{imports:[i.CommonModule,e.HttpClientModule,n.CoreModule],declarations:[l,b,T,_],exports:[l,b,T,_],providers:[u,f,I,v,S,P,k]}]}],t.ctorParameters=function(){return[{type:t,decorators:[{type:s.Optional},{type:s.SkipSelf}]}]},t}();t.HTTP_INTERCEPTORS=e.HTTP_INTERCEPTORS,t.CommonModule=i.CommonModule,t.NgModule=s.NgModule,t.Optional=s.Optional,t.SkipSelf=s.SkipSelf,t.Type=s.Type,t.PluginsConfig=r,t.PLUGINS_CONFIG=p,t.PluginsService=u,t.PluginsModuleComponent=l,t.PluginsModule=R,t.FacebookService=f,t.GoogleTagManagerComponent=b,t.GoogleTagManagerPageViewEvent=m,t.GoogleTagManagerService=v,t.GoogleService=I,t.MapboxService=S,t.PayPalWidgetComponent=T,t.PayPalService=P,t.TrustPilotWidgetComponent=_,t.TrustPilotService=k,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=designr-plugins.umd.min.js.map