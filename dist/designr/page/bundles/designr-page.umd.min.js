!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/router"),require("@angular/platform-browser"),require("@angular/common"),require("@designr/core"),require("rxjs"),require("rxjs/operators"),require("@angular/core")):"function"==typeof define&&define.amd?define("@designr/page",["exports","@angular/router","@angular/platform-browser","@angular/common","@designr/core","rxjs","rxjs/operators","@angular/core"],t):t((e.designr=e.designr||{},e.designr.page={}),e.ng.router,e.ng.platformBrowser,e.ng.common,e.i2$1,e.rxjs,e.rxjs.operators,e.ng.core)}(this,function(e,t,r,n,o,i,a,c){"use strict";var u=function(){function e(){this.version="0.0.2"}return e.prototype.ngOnInit=function(){},e.decorators=[{type:c.Component,args:[{selector:"page-module",template:'<span class="page-module">page {{version}}</span>'}]}],e.ctorParameters=function(){return[]},e}(),p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function s(e,t){function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return a}function g(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var d=function D(e){this.pages={},console.log("PageConfig",e),e&&(this.pages=e.pages||{},this.defaultPage=e.defaultPage,this.notFoundPage=e.notFoundPage)},f=new c.InjectionToken("page.config"),h=function(r){function e(e){var t=r.call(this)||this;return t.injector=e,t.scrollToTop(),t}return s(e,r),Object.defineProperty(e.prototype,"platformId",{get:function(){return this.injector.get(c.PLATFORM_ID)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"routeService",{get:function(){return this.injector.get(o.RouteService)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"router",{get:function(){return this.injector.get(t.Router)},enumerable:!0,configurable:!0}),e.prototype.scrollToTop=function(){n.isPlatformBrowser(this.platformId)&&this.router.events.subscribe(function(e){e instanceof t.NavigationEnd&&window.scrollTo(0,0)})},e.prototype.getId=function(){return this.routeService.getId()||(this.page?this.page.id:0)},e.prototype.getSlug=function(){return this.routeService.getSlug()||(this.page?this.page.slug:"")},e.decorators=[{type:c.Component,args:[{selector:"core-page",template:"<h1>I'm a default view!</h1>"}]}],e.ctorParameters=function(){return[{type:c.Injector}]},e.propDecorators={page:[{type:c.Input}],params:[{type:c.Input}],queryParams:[{type:c.Input}]},e}(o.DisposableComponent),y=function(r){function e(e){var t=r.call(this,e)||this;return t.injector=e,t.url=t.router.url,t}return s(e,r),e.decorators=[{type:c.Component,args:[{selector:"page-not-found-component",template:'<div class="container">\n\t<h3>il file <span>{{url}}</span> non è stato trovato</h3>\n</div>\n',encapsulation:c.ViewEncapsulation.Emulated,styles:[""]}]}],e.ctorParameters=function(){return[{type:c.Injector}]},e}(h),v=function(){function e(e){this.doc=e}return e.prototype.addTag=function(e){var t=this.doc.createElement("link");this.updateElementDefinition(t,e),this.doc.head.appendChild(t)},e.prototype.getTag=function(e){return this.doc.querySelector("link"+e)},e.prototype.updateTag=function(e,t){var r=this.doc.querySelector("link"+e);this.updateElementDefinition(r,t)},e.prototype.removeTag=function(e){this.doc.querySelector("link"+e).remove()},e.prototype.updateElementDefinition=function(e,t){this.updateElementAttribute(e,"href",t.href),this.updateElementAttribute(e,"id",t.id),this.updateElementAttribute(e,"rel",t.rel)},e.prototype.updateElementAttribute=function(e,t,r){r?e.setAttribute(t,r):e.removeAttribute(t)},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:c.Inject,args:[n.DOCUMENT]}]}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(n.DOCUMENT))},token:e,providedIn:"root"}),e}(),m=function q(){},S=function A(e){e&&Object.assign(this,e)},P=function B(){},b=function(){function e(e){if(this.meta={},e&&(Object.assign(this,e),e.related)){var t=e.related.map(function(e){var t=new S(e);return t.relationType=e.type,t});this.related=t}}return e.prototype.getFeature=function(t){return this.features.find(function(e){return e.id===t})||null},e.prototype.getFeatures=function(r,n){return this.features?this.features.filter(function(e,t){return-1!==n.indexOf(Number(e.id))&&e.type===r}).sort(function(e,t){return e.type-t.type}):[]},e.prototype.getFeaturesByTypes=function(t){return this.features?this.features.filter(function(e){return-1!==t.indexOf(Number(e.type))}):[]},e.prototype.getGroupedFeaturesByTypes=function(e){var n=this,o={};return e.forEach(function(t){var r=o[t]||{features:[]};n.features&&n.features.forEach(function(e){Number(e.type)===t&&r.features.push(e)}),o[t]=r}),o},e}(),j=function(u){function e(e,t,r,n,o,i){var a=u.call(this,t)||this;return a.injector=t,a.titleService=r,a.metaService=n,a.linkService=o,a.statusCodeService=i,console.log("PageService",e),e=e||{},a.options=new d(e),a}return s(e,u),Object.defineProperty(e.prototype,"collection",{get:function(){return"/api/page"},enumerable:!0,configurable:!0}),e.prototype.getStatePageBySlug=function(t){var r=this;return 0===(t=t.split("?")[0]).indexOf("/")&&(t=t.substr(1)),this.stateGet("?slug=/"+t).pipe(a.map(function(e){return e=new b(Array.isArray(e)?e.find(function(e){return e.slug==="/"+t}):e)}),a.catchError(function(e){return r.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)}))},e.prototype.getStatePageById=function(e){var t=this;return this.stateGet("/"+e).pipe(a.map(function(e){return new b(e)}),a.catchError(function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)}))},e.prototype.getPageById=function(e){var t=this;return this.get("/"+e).pipe(a.map(function(e){return new b(e)}),a.catchError(function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)}))},e.prototype.getPageBySlug=function(e){var t=this;return e=e.split(";")[0],this.get("?slug=/"+e).pipe(a.map(function(e){return new b(e)}),a.catchError(function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)}))},e.prototype.addOrUpdateMetaData=function(e){if(e){this.titleService.setTitle(e.title),this.addOrUpdateMeta({property:"og:title",content:e.title}),this.addOrUpdateMeta({property:"og:image",content:this.getSocialImage(e).url}),this.addOrUpdateMeta({property:"og:image:width",content:"1200"}),this.addOrUpdateMeta({property:"og:image:height",content:"630"}),this.addOrUpdateMeta({property:"og:url",content:e.url||this.origin});var t=e.meta;t&&(this.addOrUpdateMeta({name:"description",content:t.description||"Servizio di qualità senza costi aggiuntivi con i convenienti pacchetti viaggio Eurospin. Prenota comodamente online!"}),this.addOrUpdateMeta({name:"keywords",content:t.keywords||"viaggi,viaggi eurospin"}),this.addOrUpdateMeta({name:"robots",content:t.robots||"index,follow"}),this.addOrUpdateMeta({property:"og:locale",content:t.locale||"it_IT"}),this.addOrUpdateMeta({property:"og:type",content:t.type||"article"}),this.addOrUpdateMeta({property:"og:author",content:t.author||"Eurospin Viaggi"}),this.addOrUpdateLink({rel:"canonical",href:t.canonical||(0===this.origin.indexOf(e.url)?null:e.url)}))}},e.prototype.getSocialImage=function(e){return(e.images?e.images.find(function(e){return e.type===o.ImageType.Share})||e.images.find(function(e){return e.type===o.ImageType.Default})||e.images.find(function(e){return e.type===o.ImageType.Gallery}):null)||{url:"https://s-static.ak.fbcdn.net/images/devsite/attachment_blank.png"}},e.prototype.addOrUpdateMeta=function(e){var t=e.name?'name="'+e.name+'"':'property="'+e.property+'"';this.metaService.getTag(t)?e.content?this.metaService.updateTag(e,t):this.metaService.removeTag(t):e.content&&this.metaService.addTag(e)},e.prototype.addOrUpdateLink=function(e){var t=e.id?"#"+e.id:'[rel="'+e.rel+'"]';this.linkService.getTag(t)?e.href?this.linkService.updateTag(t,e):this.linkService.removeTag(t):e.href&&this.linkService.addTag(e)},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:d,decorators:[{type:c.Inject,args:[f]}]},{type:c.Injector},{type:r.Title},{type:r.Meta},{type:v},{type:o.HttpStatusCodeService}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(f),c.inject(c.INJECTOR),c.inject(r.Title),c.inject(r.Meta),c.inject(v),c.inject(o.HttpStatusCodeService))},token:e,providedIn:"root"}),e}(o.EntityService),I=function(u){function e(e,t,r,n,o,i){var a=u.call(this)||this;return a.viewContainerRef=e,a.router=t,a.route=r,a.componentFactoryResolver=n,a.routeService=o,a.pageService=i,a.router.routeReuseStrategy.shouldReuseRoute=function(){return!1},a.setSnapshot(a.route.snapshot),a}return s(e,u),e.prototype.setSnapshot=function(e){this.routeService.params=this.routeService.toData(e.params),this.routeService.queryParams=this.routeService.toData(e.queryParams);var t=e.data,r=this.routeService.params,n=this.routeService.queryParams,o=y;if(t.pageResolver){o=t.pageResolver.component,this.pageService.page=t.pageResolver.page;var i=this.componentFactoryResolver.resolveComponentFactory(o);this.factory=i,this.viewContainerRef.clear();var a=this.viewContainerRef.createComponent(this.factory).instance;if(a.page=t.pageResolver.page,a.params=r,a.queryParams=n,"function"==typeof a.PageInit&&a.PageInit(),t.pageResolver.page){var u=this.router.config.slice(),c=t.pageResolver.page.slug;c&&(u.push({path:0===c.indexOf("/")?c.substr(1):c,component:t.pageResolver.component}),this.router.resetConfig(u)),this.pageService.addOrUpdateMetaData(this.pageService.page)}}},e.decorators=[{type:c.Component,args:[{selector:"page-outlet",template:""}]}],e.ctorParameters=function(){return[{type:c.ViewContainerRef,decorators:[{type:c.Inject,args:[c.ViewContainerRef]}]},{type:t.Router},{type:t.ActivatedRoute},{type:c.ComponentFactoryResolver},{type:o.RouteService},{type:j}]},e}(o.DisposableComponent),C=function F(e,t){this.pageService=e,this.page=t,this.component=h,t&&this.pageService.options.pages?this.component=this.pageService.options.pages[t.component]||this.pageService.options.defaultPage:this.component=this.pageService.options.notFoundPage||y},O=function(){function e(e,t){this.pageService=e,this.routeService=t,this.events$=new i.BehaviorSubject(null)}return e.prototype.pageToPageResolver=function(e){var t=new C(this.pageService,e);return this.events$.next(t),t},e.prototype.resolve=function(e,t){if(e.params&&e.params.id)return this.getPageById(e.params.id);var r=e.url.filter(function(e){return e.path}).map(function(e){return e.path}),n=this.routeService.toSlug(r).join("/");return this.getPageBySlug(n)},e.prototype.getPageById=function(e){var t=this;return this.pageService.getPageById(e).pipe(a.map(function(e){return t.pageToPageResolver(e)}))},e.prototype.getPageBySlug=function(e){var t=this;return this.pageService.getStatePageBySlug(e).pipe(a.map(function(e){return t.pageToPageResolver(e)}))},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:j},{type:o.RouteService}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(j),c.inject(o.RouteService))},token:e,providedIn:"root"}),e}(),R=function(){function e(){}return e.prototype.match=function(e){return null===(e.url.length?e.url[e.url.length-1].path:"").match(/\.([0-9a-z]+)(?:[\?#]|$)/i)},e.prototype.canActivate=function(e,t){return this.match(e)},e.prototype.canDeactivate=function(e,t,r,n){return this.match(t)},e.decorators=[{type:c.Injectable}],e}(),T=function(){function e(){}return e.prototype.match=function(e){return null!==e.url[e.url.length-1].path.match(/\.([0-9a-z]+)(?:[\?#]|$)/i)},e.prototype.canActivate=function(e,t){return this.match(e)},e.prototype.canDeactivate=function(e,t,r,n){return this.match(t)},e.decorators=[{type:c.Injectable}],e}(),w=[{path:"page/:id",component:I,resolve:{pageResolver:O}},{path:"**",component:I,resolve:{pageResolver:O},canActivate:[R]},{path:"**",component:y,canActivate:[T]}],M=function(){function e(){}return e.decorators=[{type:c.NgModule,args:[{imports:[t.RouterModule.forChild(w)],exports:[t.RouterModule]}]}],e}(),E=[j],U=[u,h,y,I],k=[R,T],x=function(){function t(e){if(e)throw new Error("PageModule is already loaded. Import it in the AppModule only")}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:f,useValue:e}]}},t.decorators=[{type:c.NgModule,args:[{imports:[n.CommonModule,o.CoreModule,M],providers:g(E,k),declarations:g(U),exports:g([o.CoreModule,M],U)}]}],t.ctorParameters=function(){return[{type:t,decorators:[{type:c.Optional},{type:c.SkipSelf}]}]},t}();e.PageModuleComponent=u,e.PageModule=x,e.PageRouting=M,e.Page=b,e.PageIndex=S,e.PageMeta=m,e.PageRelation=P,e.PageNotFoundComponent=y,e.PageOutletComponent=I,e.PageResolver=C,e.PageResolverService=O,e.PageComponent=h,e.PageGuard=R,e.PageService=j,e.StaticGuard=T,e.ɵb=f,e.ɵa=d,e.ɵc=v,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=designr-page.umd.min.js.map