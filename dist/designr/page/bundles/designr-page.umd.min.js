!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@designr/core"),require("@angular/router"),require("rxjs"),require("@angular/platform-browser"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@designr/page",["exports","@angular/core","@angular/common","@designr/core","@angular/router","rxjs","@angular/platform-browser","rxjs/operators"],t):t(((e=e||self).designr=e.designr||{},e.designr.page={}),e.ng.core,e.ng.common,e.core$1,e.ng.router,e.rxjs,e.ng.platformBrowser,e.rxjs.operators)}(this,(function(e,t,n,r,o,i,a,u){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function s(e,t){function n(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}var f=function(e){this.pages={},this.layouts={},e&&(this.layouts=e.layouts||{},this.defaultLayout=e.defaultLayout,this.pages=e.pages||{},this.defaultPage=e.defaultPage,this.notFoundPage=e.notFoundPage)},d=new t.InjectionToken("page.config"),g=function(){function e(e){this.options=new f(e||{})}return e.ɵfac=function(n){return new(n||e)(t["ɵɵinject"](d))},e.ɵprov=t["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac,providedIn:"root"}),e}(),h=function(){function e(){}return e.ɵfac=function(t){return new(t||e)},e.ɵdir=t["ɵɵdefineDirective"]({type:e,inputs:{template:"template"}}),e}();function m(e,n){1&e&&t["ɵɵelementContainer"](0)}var v=function(){function e(){}return e.ɵfac=function(t){return new(t||e)},e.ɵcmp=t["ɵɵdefineComponent"]({type:e,selectors:[["layout-component"]],inputs:{template:"template"},decls:2,vars:2,consts:[[3,"ngClass"],[4,"ngTemplateOutlet"]],template:function(e,n){1&e&&(t["ɵɵelementStart"](0,"div",0),t["ɵɵtemplate"](1,m,1,0,"ng-container",1),t["ɵɵelementEnd"]()),2&e&&(t["ɵɵproperty"]("ngClass",null==n.page?null:n.page.component),t["ɵɵadvance"](1),t["ɵɵproperty"]("ngTemplateOutlet",n.template))},directives:[n.NgClass,n.NgTemplateOutlet],encapsulation:2}),e}(),y=function(){},S=function(e){e&&Object.assign(this,e)},j=function(){},I=function(){function e(e){if(this.meta={},e&&(Object.assign(this,e),e.related)){var t=e.related.map((function(e){var t=new S(e);return t.relationType=e.type,t}));this.related=t}}return e.prototype.getFeature=function(e){return this.features.find((function(t){return t.id===e}))||null},e.prototype.getFeatures=function(e,t){return this.features?this.features.filter((function(n,r){return-1!==t.indexOf(Number(n.id))&&n.type===e})).sort((function(e,t){return e.type-t.type})):[]},e.prototype.getFeaturesByTypes=function(e){return this.features?this.features.filter((function(t){return-1!==e.indexOf(Number(t.type))})):[]},e.prototype.getGroupedFeaturesByTypes=function(e){var t=this,n={};return e.forEach((function(e){var r=n[e]||{features:[]};t.features&&t.features.forEach((function(t){Number(t.type)===e&&r.features.push(t)})),n[e]=r})),n},e}(),P=function(){function e(e,t,n,r){this.templateRef=e,this.viewContainerRef=t,this.componentFactoryResolver=n,this.configService=r}return e.prototype.ngOnInit=function(){var e=this.configService.options,t=e.layouts[this.layoutKey]||e.defaultLayout||v,n=this.componentFactoryResolver.resolveComponentFactory(t);this.container=this.viewContainerRef.createComponent(n),this.container.instance.template=this.templateRef,this.container.instance.page=this.page},e.prototype.ngOnDestroy=function(){this.container&&(this.container.destroy(),this.container=null)},e.ɵfac=function(n){return new(n||e)(t["ɵɵdirectiveInject"](t.TemplateRef),t["ɵɵdirectiveInject"](t.ViewContainerRef),t["ɵɵdirectiveInject"](t.ComponentFactoryResolver),t["ɵɵdirectiveInject"](g))},e.ɵdir=t["ɵɵdefineDirective"]({type:e,selectors:[["","useLayout",""]],inputs:{layoutKey:["useLayout","layoutKey"],page:"page"}}),e}(),C=function(){function e(){this.version="0.0.12"}return e.prototype.ngOnInit=function(){},e.ɵfac=function(t){return new(t||e)},e.ɵcmp=t["ɵɵdefineComponent"]({type:e,selectors:[["page-module"]],decls:2,vars:1,consts:[[1,"page-module"]],template:function(e,n){1&e&&(t["ɵɵelementStart"](0,"span",0),t["ɵɵtext"](1),t["ɵɵelementEnd"]()),2&e&&(t["ɵɵadvance"](1),t["ɵɵtextInterpolate1"]("page ",n.version,""))},encapsulation:2}),e}(),b=function(e){function i(t){var n=e.call(this)||this;return n.injector=t,n.scrollToTop(),n}return s(i,e),Object.defineProperty(i.prototype,"platformId",{get:function(){return this.injector.get(t.PLATFORM_ID)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"routeService",{get:function(){return this.injector.get(r.RouteService)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"router",{get:function(){return this.injector.get(o.Router)},enumerable:!0,configurable:!0}),i.prototype.scrollToTop=function(){n.isPlatformBrowser(this.platformId)&&this.router.events.subscribe((function(e){e instanceof o.NavigationEnd&&window.scrollTo(0,0)}))},i.prototype.getId=function(){return this.routeService.getId()||(this.page?this.page.id:0)},i.prototype.getSlug=function(){return this.routeService.getSlug()||(this.page?this.page.slug:"")},i.ɵfac=function(e){return new(e||i)(t["ɵɵdirectiveInject"](t.Injector))},i.ɵcmp=t["ɵɵdefineComponent"]({type:i,selectors:[["core-page"]],inputs:{page:"page",params:"params",queryParams:"queryParams"},features:[t["ɵɵInheritDefinitionFeature"]],decls:2,vars:0,consts:[[1,"page"]],template:function(e,n){1&e&&(t["ɵɵelementStart"](0,"div",0),t["ɵɵtext"](1,"Page not found!"),t["ɵɵelementEnd"]())},encapsulation:2}),i}(r.DisposableComponent),w=function(e){function n(t){var n=e.call(this,t)||this;return n.injector=t,n.url=n.router.url,n}return s(n,e),n.ɵfac=function(e){return new(e||n)(t["ɵɵdirectiveInject"](t.Injector))},n.ɵcmp=t["ɵɵdefineComponent"]({type:n,selectors:[["page-not-found-component"]],features:[t["ɵɵInheritDefinitionFeature"]],decls:5,vars:1,consts:[[1,"page"]],template:function(e,n){1&e&&(t["ɵɵelementStart"](0,"div",0),t["ɵɵtext"](1,"Page "),t["ɵɵelementStart"](2,"span"),t["ɵɵtext"](3),t["ɵɵelementEnd"](),t["ɵɵtext"](4," not found"),t["ɵɵelementEnd"]()),2&e&&(t["ɵɵadvance"](3),t["ɵɵtextInterpolate"](n.url))},encapsulation:2}),n}(b),R=function(){function e(e){this.doc=e}return e.prototype.addTag=function(e){var t=this.doc.createElement("link");this.updateElementDefinition(t,e),this.doc.head.appendChild(t)},e.prototype.getTag=function(e){return this.doc.querySelector("link"+e)},e.prototype.updateTag=function(e,t){var n=this.doc.querySelector("link"+e);this.updateElementDefinition(n,t)},e.prototype.removeTag=function(e){this.doc.querySelector("link"+e).remove()},e.prototype.updateElementDefinition=function(e,t){this.updateElementAttribute(e,"href",t.href),this.updateElementAttribute(e,"id",t.id),this.updateElementAttribute(e,"rel",t.rel)},e.prototype.updateElementAttribute=function(e,t,n){n?e.setAttribute(t,n):e.removeAttribute(t)},e.ɵfac=function(r){return new(r||e)(t["ɵɵinject"](n.DOCUMENT))},e.ɵprov=t["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac,providedIn:"root"}),e}(),O=function(e){function n(t,n,r,o,i){var a=e.call(this,t)||this;return a.injector=t,a.titleService=n,a.metaService=r,a.linkService=o,a.statusCodeService=i,a}return s(n,e),Object.defineProperty(n.prototype,"collection",{get:function(){return"/api/page"},enumerable:!0,configurable:!0}),n.prototype.getStatePageBySlug=function(e){var t=this;return 0===(e=e.split("?")[0]).indexOf("/")&&(e=e.substr(1)),this.stateGet("?slug=/"+e).pipe(u.map((function(t){return t=new I(Array.isArray(t)?t.find((function(t){return t.slug==="/"+e})):t)})),u.catchError((function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)})))},n.prototype.getStatePageById=function(e){var t=this;return this.stateGet("/"+e).pipe(u.map((function(e){return new I(e)})),u.catchError((function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)})))},n.prototype.getPageById=function(e){var t=this;return this.get("/"+e).pipe(u.map((function(e){return new I(e)})),u.catchError((function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)})))},n.prototype.getPageBySlug=function(e){var t=this;return e=e.split(";")[0],this.get("?slug=/"+e).pipe(u.map((function(e){return new I(e)})),u.catchError((function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)})))},n.prototype.addOrUpdateMetaData=function(e){if(e){this.titleService.setTitle(e.title),this.addOrUpdateMeta({property:"og:title",content:e.title}),this.addOrUpdateMeta({property:"og:image",content:this.getSocialImage(e).url}),this.addOrUpdateMeta({property:"og:image:width",content:"1200"}),this.addOrUpdateMeta({property:"og:image:height",content:"630"}),this.addOrUpdateMeta({property:"og:url",content:e.url||this.origin});var t=e.meta;t&&(this.addOrUpdateMeta({name:"description",content:t.description||"Servizio di qualità senza costi aggiuntivi con i convenienti pacchetti viaggio Eurospin. Prenota comodamente online!"}),this.addOrUpdateMeta({name:"keywords",content:t.keywords||"viaggi,viaggi eurospin"}),this.addOrUpdateMeta({name:"robots",content:t.robots||"index,follow"}),this.addOrUpdateMeta({property:"og:locale",content:t.locale||"it_IT"}),this.addOrUpdateMeta({property:"og:type",content:t.type||"article"}),this.addOrUpdateMeta({property:"og:author",content:t.author||"Eurospin Viaggi"}),this.addOrUpdateLink({rel:"canonical",href:t.canonical||(0===this.origin.indexOf(e.url)?null:e.url)}))}},n.prototype.getSocialImage=function(e){return(e.images?e.images.find((function(e){return e.type===r.ImageType.Share}))||e.images.find((function(e){return e.type===r.ImageType.Default}))||e.images.find((function(e){return e.type===r.ImageType.Gallery})):null)||{url:"https://s-static.ak.fbcdn.net/images/devsite/attachment_blank.png"}},n.prototype.addOrUpdateMeta=function(e){var t=e.name?'name="'+e.name+'"':'property="'+e.property+'"';this.metaService.getTag(t)?e.content?this.metaService.updateTag(e,t):this.metaService.removeTag(t):e.content&&this.metaService.addTag(e)},n.prototype.addOrUpdateLink=function(e){var t=e.id?"#"+e.id:'[rel="'+e.rel+'"]';this.linkService.getTag(t)?e.href?this.linkService.updateTag(t,e):this.linkService.removeTag(t):e.href&&this.linkService.addTag(e)},n.ɵfac=function(e){return new(e||n)(t["ɵɵinject"](t.Injector),t["ɵɵinject"](a.Title),t["ɵɵinject"](a.Meta),t["ɵɵinject"](R),t["ɵɵinject"](r.HttpStatusCodeService))},n.ɵprov=t["ɵɵdefineInjectable"]({token:n,factory:n.ɵfac,providedIn:"root"}),n}(r.EntityService),M=["outlet"];function T(e,t){}var x=function(e){function n(t,n,r,o,i){var a=e.call(this)||this;return a.router=t,a.route=n,a.componentFactoryResolver=r,a.routeService=o,a.pageService=i,a.router.routeReuseStrategy.shouldReuseRoute=function(){return!1},a}return s(n,e),n.prototype.ngOnInit=function(){this.setSnapshot(this.route.snapshot)},n.prototype.setSnapshot=function(e){this.routeService.params=this.routeService.toData(e.params),this.routeService.queryParams=this.routeService.toData(e.queryParams);var t=e.data,n=this.routeService.params,r=this.routeService.queryParams,o=w;if(t.pageResolver){o=t.pageResolver.component;var i=t.pageResolver.page,a=this.componentFactoryResolver.resolveComponentFactory(o);this.viewContainerRef.clear();var u=this.viewContainerRef.createComponent(a),c=u.instance;if(c.page=i,c.params=n,c.queryParams=r,"function"==typeof c.PageInit&&c.PageInit(),this.componentRef=u,i){var s=this.router.config.slice(),p=i.slug;p&&(s.push({path:0===p.indexOf("/")?p.substr(1):p,component:o}),this.router.resetConfig(s)),this.pageService.addOrUpdateMetaData(i)}}},n.prototype.ngOnDestroy=function(){this.componentRef.destroy()},n.ɵfac=function(e){return new(e||n)(t["ɵɵdirectiveInject"](o.Router),t["ɵɵdirectiveInject"](o.ActivatedRoute),t["ɵɵdirectiveInject"](t.ComponentFactoryResolver),t["ɵɵdirectiveInject"](r.RouteService),t["ɵɵdirectiveInject"](O))},n.ɵcmp=t["ɵɵdefineComponent"]({type:n,selectors:[["page-outlet"]],viewQuery:function(e,n){var r;(1&e&&t["ɵɵstaticViewQuery"](M,!0,t.ViewContainerRef),2&e)&&(t["ɵɵqueryRefresh"](r=t["ɵɵloadQuery"]())&&(n.viewContainerRef=r.first))},features:[t["ɵɵInheritDefinitionFeature"]],decls:2,vars:0,consts:[["outlet",""]],template:function(e,n){1&e&&t["ɵɵtemplate"](0,T,0,0,"ng-template",null,0,t["ɵɵtemplateRefExtractor"])},encapsulation:2}),n}(r.DisposableComponent),E=function(e,t){this.configService=e,this.page=t,this.component=b,t&&this.configService.options.pages?this.component=this.configService.options.pages[t.component]||this.configService.options.defaultPage:this.component=this.configService.options.notFoundPage||w},k=function(){function e(e,t,n){this.configService=e,this.pageService=t,this.routeService=n,this.events$=new i.BehaviorSubject(null)}return e.prototype.pageToPageResolver=function(e){var t=new E(this.configService,e);return this.events$.next(t),t},e.prototype.resolve=function(e,t){if(e.params&&e.params.id)return this.getPageById(e.params.id);var n=e.url.filter((function(e){return e.path})).map((function(e){return e.path})),r=this.routeService.toSlug(n).join("/");return this.getPageBySlug(r)},e.prototype.getPageById=function(e){var t=this;return this.pageService.getPageById(e).pipe(u.map((function(e){return t.pageToPageResolver(e)})))},e.prototype.getPageBySlug=function(e){var t=this;return this.pageService.getStatePageBySlug(e).pipe(u.map((function(e){return t.pageToPageResolver(e)})))},e.ɵfac=function(n){return new(n||e)(t["ɵɵinject"](g),t["ɵɵinject"](O),t["ɵɵinject"](r.RouteService))},e.ɵprov=t["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac,providedIn:"root"}),e}(),D=function(){function e(){}return e.prototype.match=function(e){return null===(e.url.length?e.url[e.url.length-1].path:"").match(/\.([0-9a-z]+)(?:[\?#]|$)/i)},e.prototype.canActivate=function(e,t){return this.match(e)},e.prototype.canDeactivate=function(e,t,n,r){return this.match(t)},e.ɵfac=function(t){return new(t||e)},e.ɵprov=t["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac}),e}(),U=function(){function e(){}return e.prototype.match=function(e){return null!==e.url[e.url.length-1].path.match(/\.([0-9a-z]+)(?:[\?#]|$)/i)},e.prototype.canActivate=function(e,t){return this.match(e)},e.prototype.canDeactivate=function(e,t,n,r){return this.match(t)},e.ɵfac=function(t){return new(t||e)},e.ɵprov=t["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac}),e}(),F=[{path:"page/:id",component:x,resolve:{pageResolver:k}},{path:"**",component:x,resolve:{pageResolver:k},canActivate:[D]},{path:"**",component:w,canActivate:[U]}],q=function(){function e(){}return e.ɵmod=t["ɵɵdefineNgModule"]({type:e}),e.ɵinj=t["ɵɵdefineInjector"]({factory:function(t){return new(t||e)},imports:[[o.RouterModule.forChild(F)],o.RouterModule]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&t["ɵɵsetNgModuleScope"](q,{imports:[o.RouterModule],exports:[o.RouterModule]});var A=[g,O],B=[D,U],_=function(){function e(e){if(e)throw new Error("PageModule is already loaded. Import it in the AppModule only")}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:d,useValue:t}]}},e.ɵmod=t["ɵɵdefineNgModule"]({type:e}),e.ɵinj=t["ɵɵdefineInjector"]({factory:function(n){return new(n||e)(t["ɵɵinject"](e,12))},providers:l(A,B),imports:[[n.CommonModule,r.CoreModule,q],r.CoreModule,q]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&t["ɵɵsetNgModuleScope"](_,{declarations:[C,b,w,x,v,P],imports:[n.CommonModule,r.CoreModule,q],exports:[r.CoreModule,q,C,b,w,x,v,P]}),e.ConfigService=g,e.ILayoutComponent=h,e.LayoutComponent=v,e.PAGE_CONFIG=d,e.Page=I,e.PageComponent=b,e.PageConfig=f,e.PageGuard=D,e.PageIndex=S,e.PageMeta=y,e.PageModule=_,e.PageModuleComponent=C,e.PageNotFoundComponent=w,e.PageOutletComponent=x,e.PageRelation=j,e.PageResolver=E,e.PageResolverService=k,e.PageRouting=q,e.PageService=O,e.StaticGuard=U,e.UseLayoutDirective=P,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=designr-page.umd.min.js.map