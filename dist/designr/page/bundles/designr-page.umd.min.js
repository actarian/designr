!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/router"),require("@angular/platform-browser"),require("@angular/common"),require("@designr/core"),require("rxjs"),require("rxjs/operators"),require("@angular/core")):"function"==typeof define&&define.amd?define("@designr/page",["exports","@angular/router","@angular/platform-browser","@angular/common","@designr/core","rxjs","rxjs/operators","@angular/core"],t):t((e.designr=e.designr||{},e.designr.page={}),e.ng.router,e.ng.platformBrowser,e.ng.common,e.i3,e.rxjs,e.rxjs.operators,e.ng.core)}(this,function(e,t,r,n,o,i,u,c){"use strict";var a=function _(e){this.pages={},this.layouts={},e&&(this.layouts=e.layouts||{},this.defaultLayout=e.defaultLayout,this.pages=e.pages||{},this.defaultPage=e.defaultPage,this.notFoundPage=e.notFoundPage)},p=new c.InjectionToken("page.config"),s=function(){function e(e){this.options=new a(e||{})}return e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:a,decorators:[{type:c.Inject,args:[p]}]}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(p))},token:e,providedIn:"root"}),e}(),l=function(){function e(){}return e.propDecorators={template:[{type:c.Input}]},e}(),f=function(){function e(){}return e.decorators=[{type:c.Component,args:[{selector:"layout-component",template:'<div [ngClass]="page?.component">\n\t<ng-container *ngTemplateOutlet="template"></ng-container>\n</div>'}]}],e.propDecorators={template:[{type:c.Input}]},e}(),g=function(){function e(e,t,r,n){this.templateRef=e,this.viewContainerRef=t,this.componentFactoryResolver=r,this.configService=n}return e.prototype.ngOnInit=function(){var e=this.configService.options,t=e.layouts[this.layoutKey]||e.defaultLayout||f,r=this.componentFactoryResolver.resolveComponentFactory(t);this.container=this.viewContainerRef.createComponent(r),this.container.instance.template=this.templateRef,this.container.instance.page=this.page},e.prototype.ngOnDestroy=function(){this.container&&(this.container.destroy(),this.container=null)},e.decorators=[{type:c.Directive,args:[{selector:"[useLayout]"}]}],e.ctorParameters=function(){return[{type:c.TemplateRef},{type:c.ViewContainerRef},{type:c.ComponentFactoryResolver},{type:s}]},e.propDecorators={layoutKey:[{type:c.Input,args:["useLayout"]}],page:[{type:c.Input}]},e}(),d=function(){function e(){this.version="0.0.10"}return e.prototype.ngOnInit=function(){},e.decorators=[{type:c.Component,args:[{selector:"page-module",template:'<span class="page-module">page {{version}}</span>'}]}],e.ctorParameters=function(){return[]},e}(),y=function(e,t){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function h(e,t){function r(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function m(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return a}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(m(arguments[t]));return e}var S=function(r){function e(e){var t=r.call(this)||this;return t.injector=e,t.scrollToTop(),t}return h(e,r),Object.defineProperty(e.prototype,"platformId",{get:function(){return this.injector.get(c.PLATFORM_ID)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"routeService",{get:function(){return this.injector.get(o.RouteService)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"router",{get:function(){return this.injector.get(t.Router)},enumerable:!0,configurable:!0}),e.prototype.scrollToTop=function(){n.isPlatformBrowser(this.platformId)&&this.router.events.subscribe(function(e){e instanceof t.NavigationEnd&&window.scrollTo(0,0)})},e.prototype.getId=function(){return this.routeService.getId()||(this.page?this.page.id:0)},e.prototype.getSlug=function(){return this.routeService.getSlug()||(this.page?this.page.slug:"")},e.decorators=[{type:c.Component,args:[{selector:"core-page",template:'<div class="page">Page not found!</div>'}]}],e.ctorParameters=function(){return[{type:c.Injector}]},e.propDecorators={page:[{type:c.Input}],params:[{type:c.Input}],queryParams:[{type:c.Input}]},e}(o.DisposableComponent),P=function(r){function e(e){var t=r.call(this,e)||this;return t.injector=e,t.url=t.router.url,t}return h(e,r),e.decorators=[{type:c.Component,args:[{selector:"page-not-found-component",template:'<div class="page">Page <span>{{url}}</span> not found</div>',encapsulation:c.ViewEncapsulation.Emulated}]}],e.ctorParameters=function(){return[{type:c.Injector}]},e}(S),I=function(){function e(e){this.doc=e}return e.prototype.addTag=function(e){var t=this.doc.createElement("link");this.updateElementDefinition(t,e),this.doc.head.appendChild(t)},e.prototype.getTag=function(e){return this.doc.querySelector("link"+e)},e.prototype.updateTag=function(e,t){var r=this.doc.querySelector("link"+e);this.updateElementDefinition(r,t)},e.prototype.removeTag=function(e){this.doc.querySelector("link"+e).remove()},e.prototype.updateElementDefinition=function(e,t){this.updateElementAttribute(e,"href",t.href),this.updateElementAttribute(e,"id",t.id),this.updateElementAttribute(e,"rel",t.rel)},e.prototype.updateElementAttribute=function(e,t,r){r?e.setAttribute(t,r):e.removeAttribute(t)},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:c.Inject,args:[n.DOCUMENT]}]}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(n.DOCUMENT))},token:e,providedIn:"root"}),e}(),b=function L(){},j=function N(e){e&&Object.assign(this,e)},C=function G(){},O=function(){function e(e){if(this.meta={},e&&(Object.assign(this,e),e.related)){var t=e.related.map(function(e){var t=new j(e);return t.relationType=e.type,t});this.related=t}}return e.prototype.getFeature=function(t){return this.features.find(function(e){return e.id===t})||null},e.prototype.getFeatures=function(r,n){return this.features?this.features.filter(function(e,t){return-1!==n.indexOf(Number(e.id))&&e.type===r}).sort(function(e,t){return e.type-t.type}):[]},e.prototype.getFeaturesByTypes=function(t){return this.features?this.features.filter(function(e){return-1!==t.indexOf(Number(e.type))}):[]},e.prototype.getGroupedFeaturesByTypes=function(e){var n=this,o={};return e.forEach(function(t){var r=o[t]||{features:[]};n.features&&n.features.forEach(function(e){Number(e.type)===t&&r.features.push(e)}),o[t]=r}),o},e}(),R=function(a){function e(e,t,r,n,o){var i=a.call(this,e)||this;return i.injector=e,i.titleService=t,i.metaService=r,i.linkService=n,i.statusCodeService=o,i}return h(e,a),Object.defineProperty(e.prototype,"collection",{get:function(){return"/api/page"},enumerable:!0,configurable:!0}),e.prototype.getStatePageBySlug=function(t){var r=this;return 0===(t=t.split("?")[0]).indexOf("/")&&(t=t.substr(1)),this.stateGet("?slug=/"+t).pipe(u.map(function(e){return e=new O(Array.isArray(e)?e.find(function(e){return e.slug==="/"+t}):e)}),u.catchError(function(e){return r.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)}))},e.prototype.getStatePageById=function(e){var t=this;return this.stateGet("/"+e).pipe(u.map(function(e){return new O(e)}),u.catchError(function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)}))},e.prototype.getPageById=function(e){var t=this;return this.get("/"+e).pipe(u.map(function(e){return new O(e)}),u.catchError(function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)}))},e.prototype.getPageBySlug=function(e){var t=this;return e=e.split(";")[0],this.get("?slug=/"+e).pipe(u.map(function(e){return new O(e)}),u.catchError(function(e){return t.statusCodeService.setStatusCode(e.status,e.error?e.error.redirectUrl:null),i.of(null)}))},e.prototype.addOrUpdateMetaData=function(e){if(e){this.titleService.setTitle(e.title),this.addOrUpdateMeta({property:"og:title",content:e.title}),this.addOrUpdateMeta({property:"og:image",content:this.getSocialImage(e).url}),this.addOrUpdateMeta({property:"og:image:width",content:"1200"}),this.addOrUpdateMeta({property:"og:image:height",content:"630"}),this.addOrUpdateMeta({property:"og:url",content:e.url||this.origin});var t=e.meta;t&&(this.addOrUpdateMeta({name:"description",content:t.description||"Servizio di qualità senza costi aggiuntivi con i convenienti pacchetti viaggio Eurospin. Prenota comodamente online!"}),this.addOrUpdateMeta({name:"keywords",content:t.keywords||"viaggi,viaggi eurospin"}),this.addOrUpdateMeta({name:"robots",content:t.robots||"index,follow"}),this.addOrUpdateMeta({property:"og:locale",content:t.locale||"it_IT"}),this.addOrUpdateMeta({property:"og:type",content:t.type||"article"}),this.addOrUpdateMeta({property:"og:author",content:t.author||"Eurospin Viaggi"}),this.addOrUpdateLink({rel:"canonical",href:t.canonical||(0===this.origin.indexOf(e.url)?null:e.url)}))}},e.prototype.getSocialImage=function(e){return(e.images?e.images.find(function(e){return e.type===o.ImageType.Share})||e.images.find(function(e){return e.type===o.ImageType.Default})||e.images.find(function(e){return e.type===o.ImageType.Gallery}):null)||{url:"https://s-static.ak.fbcdn.net/images/devsite/attachment_blank.png"}},e.prototype.addOrUpdateMeta=function(e){var t=e.name?'name="'+e.name+'"':'property="'+e.property+'"';this.metaService.getTag(t)?e.content?this.metaService.updateTag(e,t):this.metaService.removeTag(t):e.content&&this.metaService.addTag(e)},e.prototype.addOrUpdateLink=function(e){var t=e.id?"#"+e.id:'[rel="'+e.rel+'"]';this.linkService.getTag(t)?e.href?this.linkService.updateTag(t,e):this.linkService.removeTag(t):e.href&&this.linkService.addTag(e)},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:c.Injector},{type:r.Title},{type:r.Meta},{type:I},{type:o.HttpStatusCodeService}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(c.INJECTOR),c.inject(r.Title),c.inject(r.Meta),c.inject(I),c.inject(o.HttpStatusCodeService))},token:e,providedIn:"root"}),e}(o.EntityService),w=function(a){function e(e,t,r,n,o){var i=a.call(this)||this;return i.router=e,i.route=t,i.componentFactoryResolver=r,i.routeService=n,i.pageService=o,i.router.routeReuseStrategy.shouldReuseRoute=function(){return!1},i}return h(e,a),e.prototype.ngOnInit=function(){this.setSnapshot(this.route.snapshot)},e.prototype.setSnapshot=function(e){this.routeService.params=this.routeService.toData(e.params),this.routeService.queryParams=this.routeService.toData(e.queryParams);var t=e.data,r=this.routeService.params,n=this.routeService.queryParams,o=P;if(t.pageResolver){o=t.pageResolver.component;var i=t.pageResolver.page,a=this.componentFactoryResolver.resolveComponentFactory(o);this.viewContainerRef.clear();var u=this.viewContainerRef.createComponent(a),c=u.instance;if(c.page=i,c.params=r,c.queryParams=n,"function"==typeof c.PageInit&&c.PageInit(),this.componentRef=u,i){var p=this.router.config.slice(),s=i.slug;s&&(p.push({path:0===s.indexOf("/")?s.substr(1):s,component:o}),this.router.resetConfig(p)),this.pageService.addOrUpdateMetaData(i)}}},e.prototype.ngOnDestroy=function(){this.componentRef.destroy()},e.decorators=[{type:c.Component,args:[{selector:"page-outlet",template:"<ng-template #outlet></ng-template>"}]}],e.ctorParameters=function(){return[{type:t.Router},{type:t.ActivatedRoute},{type:c.ComponentFactoryResolver},{type:o.RouteService},{type:R}]},e.propDecorators={viewContainerRef:[{type:c.ViewChild,args:["outlet",{read:c.ViewContainerRef}]}]},e}(o.DisposableComponent),T=function V(e,t){this.configService=e,this.page=t,this.component=S,t&&this.configService.options.pages?this.component=this.configService.options.pages[t.component]||this.configService.options.defaultPage:this.component=this.configService.options.notFoundPage||P},M=function(){function e(e,t,r){this.configService=e,this.pageService=t,this.routeService=r,this.events$=new i.BehaviorSubject(null)}return e.prototype.pageToPageResolver=function(e){var t=new T(this.configService,e);return this.events$.next(t),t},e.prototype.resolve=function(e,t){if(e.params&&e.params.id)return this.getPageById(e.params.id);var r=e.url.filter(function(e){return e.path}).map(function(e){return e.path}),n=this.routeService.toSlug(r).join("/");return this.getPageBySlug(n)},e.prototype.getPageById=function(e){var t=this;return this.pageService.getPageById(e).pipe(u.map(function(e){return t.pageToPageResolver(e)}))},e.prototype.getPageBySlug=function(e){var t=this;return this.pageService.getStatePageBySlug(e).pipe(u.map(function(e){return t.pageToPageResolver(e)}))},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:s},{type:R},{type:o.RouteService}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(s),c.inject(R),c.inject(o.RouteService))},token:e,providedIn:"root"}),e}(),D=function(){function e(){}return e.prototype.match=function(e){return null===(e.url.length?e.url[e.url.length-1].path:"").match(/\.([0-9a-z]+)(?:[\?#]|$)/i)},e.prototype.canActivate=function(e,t){return this.match(e)},e.prototype.canDeactivate=function(e,t,r,n){return this.match(t)},e.decorators=[{type:c.Injectable}],e}(),E=function(){function e(){}return e.prototype.match=function(e){return null!==e.url[e.url.length-1].path.match(/\.([0-9a-z]+)(?:[\?#]|$)/i)},e.prototype.canActivate=function(e,t){return this.match(e)},e.prototype.canDeactivate=function(e,t,r,n){return this.match(t)},e.decorators=[{type:c.Injectable}],e}(),U=[{path:"page/:id",component:w,resolve:{pageResolver:M}},{path:"**",component:w,resolve:{pageResolver:M},canActivate:[D]},{path:"**",component:P,canActivate:[E]}],k=function(){function e(){}return e.decorators=[{type:c.NgModule,args:[{imports:[t.RouterModule.forChild(U)],exports:[t.RouterModule]}]}],e}(),x=[s,R],F=[d,S,P,w,f],A=[g],q=[D,E],B=function(){function t(e){if(e)throw new Error("PageModule is already loaded. Import it in the AppModule only")}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:p,useValue:e}]}},t.decorators=[{type:c.NgModule,args:[{imports:[n.CommonModule,o.CoreModule,k],providers:v(x,q),declarations:v(F,A),entryComponents:v(F),exports:v([o.CoreModule,k],F,A)}]}],t.ctorParameters=function(){return[{type:t,decorators:[{type:c.Optional},{type:c.SkipSelf}]}]},t}();e.ConfigService=s,e.PageConfig=a,e.PAGE_CONFIG=p,e.ILayoutComponent=l,e.LayoutComponent=f,e.UseLayoutDirective=g,e.PageModuleComponent=d,e.PageModule=B,e.PageRouting=k,e.Page=O,e.PageIndex=j,e.PageMeta=b,e.PageRelation=C,e.PageNotFoundComponent=P,e.PageOutletComponent=w,e.PageResolver=T,e.PageResolverService=M,e.PageComponent=S,e.PageGuard=D,e.PageService=R,e.StaticGuard=E,e.ɵa=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=designr-page.umd.min.js.map