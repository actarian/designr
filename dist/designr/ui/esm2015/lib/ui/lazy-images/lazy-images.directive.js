/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isPlatformBrowser } from '@angular/common';
import { Directive, ElementRef, Inject, Input, NgZone, PLATFORM_ID, Renderer2 } from '@angular/core';
// use require for polyfill
export class LazyImagesDirective {
    /**
     * @param {?} platformId
     * @param {?} element
     * @param {?} renderer
     * @param {?} zone
     */
    constructor(platformId, element, renderer, zone) {
        this.platformId = platformId;
        this.renderer = renderer;
        this.zone = zone;
        this.nativeElement = element.nativeElement;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (!isPlatformBrowser(this.platformId)) {
            return;
        }
        this.zone.runOutsideAngular(() => {
            require('intersection-observer'); // use require for polyfill
            this.onRegister();
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.observer) {
            this.observer.disconnect();
        }
    }
    /**
     * @return {?}
     */
    onRegister() {
        this.newIntersectionObserver();
        /** @type {?} */
        const observer = new MutationObserver(mutations => this.onChange(mutations));
        /** @type {?} */
        const config = {
            attributes: true,
            characterData: true,
            childList: true,
            subtree: true
        };
        observer.observe(this.nativeElement, config);
        this.onChange();
        // this.observeDOMChanges(this.nativeElement, () => this.onChange);
    }
    /**
     * @param {...?} data
     * @return {?}
     */
    onChange(...data) {
        /** @type {?} */
        const images = Array.from(this.nativeElement.querySelectorAll('img[data-src], [data-srcset], [data-background-src]'));
        images.forEach((image) => this.observer.observe(image));
    }
    /**
     * @return {?}
     */
    newIntersectionObserver() {
        /** @type {?} */
        const config = this.lazyImages instanceof Object ? this.lazyImages : undefined;
        this.observer = new IntersectionObserver((images) => images.forEach(image => {
            if (!image.isIntersecting) {
                return;
            }
            this.onAppearsInViewport(image.target);
        }), config);
        return this.observer;
    }
    /**
     * @param {?} image
     * @return {?}
     */
    onAppearsInViewport(image) {
        if (image.dataset.src) {
            /** @type {?} */
            const input = image.dataset.src;
            this.onImagePreload(input, (output) => {
                this.renderer.setAttribute(image, 'src', output);
                this.renderer.removeAttribute(image, 'data-src');
                this.zone.runOutsideAngular(() => {
                    setTimeout(() => {
                        this.renderer.addClass(image, 'ready');
                    }, 1);
                });
            });
        }
        if (image.dataset.srcset) {
            this.renderer.setAttribute(image, 'srcset', image.dataset.srcset);
            this.renderer.removeAttribute(image, 'data-srcset');
        }
        if (image.dataset.backgroundSrc) {
            this.renderer.setStyle(image, 'background-image', `url(${image.dataset.backgroundSrc})`);
            this.renderer.removeAttribute(image, 'data-background-src');
        }
        if (this.observer) {
            this.observer.unobserve(image);
        }
    }
    /**
     * @param {?} src
     * @param {?} callback
     * @return {?}
     */
    onImagePreload(src, callback) {
        /** @type {?} */
        const img = new Image();
        img.onload = () => {
            if (typeof callback === 'function') {
                callback(img.src);
            }
        };
        img.onerror = function (e) {
            img.onerror = null;
            img.src = 'data:image/png;base64,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';
        };
        img.src = src;
    }
}
LazyImagesDirective.decorators = [
    { type: Directive, args: [{
                selector: '[lazy-images]'
            },] }
];
/** @nocollapse */
LazyImagesDirective.ctorParameters = () => [
    { type: String, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone }
];
LazyImagesDirective.propDecorators = {
    lazyImages: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    LazyImagesDirective.prototype.lazyImages;
    /** @type {?} */
    LazyImagesDirective.prototype.observer;
    /** @type {?} */
    LazyImagesDirective.prototype.nativeElement;
    /**
     * @type {?}
     * @private
     */
    LazyImagesDirective.prototype.platformId;
    /** @type {?} */
    LazyImagesDirective.prototype.renderer;
    /** @type {?} */
    LazyImagesDirective.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF6eS1pbWFnZXMuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGRlc2lnbnIvdWkvIiwic291cmNlcyI6WyJsaWIvdWkvbGF6eS1pbWFnZXMvbGF6eS1pbWFnZXMuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBcUIsV0FBVyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFPeEgsTUFBTSxPQUFPLG1CQUFtQjs7Ozs7OztJQU8vQixZQUM4QixVQUFrQixFQUMvQyxPQUFtQixFQUNaLFFBQW1CLEVBQ25CLElBQVk7UUFIVSxlQUFVLEdBQVYsVUFBVSxDQUFRO1FBRXhDLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUVuQixJQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUM7SUFDNUMsQ0FBQzs7OztJQUVELFFBQVE7UUFDUCxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFO1lBQ3hDLE9BQU87U0FDUDtRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFO1lBQ2hDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUMsMkJBQTJCO1lBQzdELElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztJQUNKLENBQUM7Ozs7SUFFRCxXQUFXO1FBQ1YsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLENBQUM7U0FDM0I7SUFDRixDQUFDOzs7O0lBRUQsVUFBVTtRQUNULElBQUksQ0FBQyx1QkFBdUIsRUFB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LENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUscUJBQXFCLENBQUMsQ0FBQztTQUM1RDtRQUNELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUMvQjtJQUNGLENBQUM7Ozs7OztJQUVELGNBQWMsQ0FBQyxHQUFXLEVBQUUsUUFBa0I7O2NBQ3ZDLEdBQUcsR0FBRyxJQUFJLEtBQUssRUFBRTtRQUN2QixHQUFHLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRTtZQUNqQixJQUFJLE9BQU8sUUFBUSxLQUFLLFVBQVUsRUFBRTtnQkFDbkMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNsQjtRQUNGLENBQUMsQ0FBQztRQUNGLEdBQUcsQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDO1lBQ3hCLEdBQUcsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQ25CLEdBQUcsQ0FBQyxHQUFHLEdBQUcsdzBHQUF3MEcsQ0FBQztRQUNwMUcsQ0FBQyxDQUFDO1FBQ0YsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDZixDQUFDOzs7WUF2R0QsU0FBUyxTQUFDO2dCQUNWLFFBQVEsRUFBRSxlQUFlO2FBQ3pCOzs7O3lDQVNFLE1BQU0sU0FBQyxXQUFXO1lBZkQsVUFBVTtZQUF5RCxTQUFTO1lBQWpELE1BQU07Ozt5QkFTbkQsS0FBSzs7OztJQUFOLHlDQUNtQjs7SUFDbkIsdUNBQStCOztJQUMvQiw0Q0FBMkI7Ozs7O0lBRzFCLHlDQUErQzs7SUFFL0MsdUNBQTBCOztJQUMxQixtQ0FBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSW5qZWN0LCBJbnB1dCwgTmdab25lLCBPbkRlc3Ryb3ksIE9uSW5pdCwgUExBVEZPUk1fSUQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuZGVjbGFyZSB2YXIgcmVxdWlyZTogYW55OyAvLyB1c2UgcmVxdWlyZSBmb3IgcG9seWZpbGxcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG5cdHNlbGVjdG9yOiAnW2xhenktaW1hZ2VzXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIExhenlJbWFnZXNEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcblxyXG5cdEBJbnB1dCgpXHJcblx0bGF6eUltYWdlczogT2JqZWN0O1xyXG5cdG9ic2VydmVyOiBJbnRlcnNlY3Rpb25PYnNlcnZlcjtcclxuXHRuYXRpdmVFbGVtZW50OiBIVE1MRWxlbWVudDtcclxuXHJcblx0Y29uc3RydWN0b3IoXHJcblx0XHRASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IHN0cmluZyxcclxuXHRcdGVsZW1lbnQ6IEVsZW1lbnRSZWYsXHJcblx0XHRwdWJsaWMgcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuXHRcdHB1YmxpYyB6b25lOiBOZ1pvbmUsXHJcblx0KSB7XHJcblx0XHR0aGlzLm5hdGl2ZUVsZW1lbnQgPSBlbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XHJcblx0fVxyXG5cclxuXHRuZ09uSW5pdCgpIHtcclxuXHRcdGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHR0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG5cdFx0XHRyZXF1aXJlKCdpbnRlcnNlY3Rpb24tb2JzZXJ2ZXInKTsgLy8gdXNlIHJlcXVpcmUgZm9yIHBvbHlmaWxsXHJcblx0XHRcdHRoaXMub25SZWdpc3RlcigpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRuZ09uRGVzdHJveSgpIHtcclxuXHRcdGlmICh0aGlzLm9ic2VydmVyKSB7XHJcblx0XHRcdHRoaXMub2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0b25SZWdpc3RlcigpIHtcclxuXHRcdHRoaXMubmV3SW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKTtcclxuXHRcdGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIobXV0YXRpb25zID0+IHRoaXMub25DaGFuZ2UobXV0YXRpb25zKSk7XHJcblx0XHRjb25zdCBjb25maWcgPSB7XHJcblx0XHRcdGF0dHJpYnV0ZXM6IHRydWUsXHJcblx0XHRcdGNoYXJhY3RlckRhdGE6IHRydWUsXHJcblx0XHRcdGNoaWxkTGlzdDogdHJ1ZSxcclxuXHRcdFx0c3VidHJlZTogdHJ1ZVxyXG5cdFx0fTtcclxuXHRcdG9ic2VydmVyLm9ic2VydmUodGhpcy5uYXRpdmVFbGVtZW50LCBjb25maWcpO1xyXG5cdFx0dGhpcy5vbkNoYW5nZSgpO1xyXG5cdFx0Ly8gdGhpcy5vYnNlcnZlRE9NQ2hhbmdlcyh0aGlzLm5hdGl2ZUVsZW1lbnQsICgpID0+IHRoaXMub25DaGFuZ2UpO1xyXG5cdH1cclxuXHJcblx0b25DaGFuZ2UoLi4uZGF0YSkge1xyXG5cdFx0Y29uc3QgaW1hZ2VzID0gQXJyYXkuZnJvbSh0aGlzLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW1nW2RhdGEtc3JjXSwgW2RhdGEtc3Jjc2V0XSwgW2RhdGEtYmFja2dyb3VuZC1zcmNdJykpO1xyXG5cdFx0aW1hZ2VzLmZvckVhY2goKGltYWdlOiBIVE1MRWxlbWVudCkgPT4gdGhpcy5vYnNlcnZlci5vYnNlcnZlKGltYWdlKSk7XHJcblx0fVxyXG5cclxuXHRuZXdJbnRlcnNlY3Rpb25PYnNlcnZlcigpIHtcclxuXHRcdGNvbnN0IGNvbmZpZyA9IHRoaXMubGF6eUltYWdlcyBpbnN0YW5jZW9mIE9iamVjdCA/IHRoaXMubGF6eUltYWdlcyA6IHVuZGVmaW5lZDtcclxuXHRcdHRoaXMub2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKGltYWdlczogYW55W10pID0+IGltYWdlcy5mb3JFYWNoKGltYWdlID0+IHtcclxuXHRcdFx0aWYgKCFpbWFnZS5pc0ludGVyc2VjdGluZykge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLm9uQXBwZWFyc0luVmlld3BvcnQoaW1hZ2UudGFyZ2V0KTtcclxuXHRcdH0pLCBjb25maWcpO1xyXG5cdFx0cmV0dXJuIHRoaXMub2JzZXJ2ZXI7XHJcblx0fVxyXG5cclxuXHRvbkFwcGVhcnNJblZpZXdwb3J0KGltYWdlOiBhbnkpIHtcclxuXHRcdGlmIChpbWFnZS5kYXRhc2V0LnNyYykge1xyXG5cdFx0XHRjb25zdCBpbnB1dCA9IGltYWdlLmRhdGFzZXQuc3JjO1xyXG5cdFx0XHR0aGlzLm9uSW1hZ2VQcmVsb2FkKGlucHV0LCAob3V0cHV0KSA9PiB7XHJcblx0XHRcdFx0dGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoaW1hZ2UsICdzcmMnLCBvdXRwdXQpO1xyXG5cdFx0XHRcdHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGltYWdlLCAnZGF0YS1zcmMnKTtcclxuXHRcdFx0XHR0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG5cdFx0XHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XHJcblx0XHRcdFx0XHRcdHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MoaW1hZ2UsICdyZWFkeScpO1xyXG5cdFx0XHRcdFx0fSwgMSk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0aWYgKGltYWdlLmRhdGFzZXQuc3Jjc2V0KSB7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKGltYWdlLCAnc3Jjc2V0JywgaW1hZ2UuZGF0YXNldC5zcmNzZXQpO1xyXG5cdFx0XHR0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZShpbWFnZSwgJ2RhdGEtc3Jjc2V0Jyk7XHJcblx0XHR9XHJcblx0XHRpZiAoaW1hZ2UuZGF0YXNldC5iYWNrZ3JvdW5kU3JjKSB7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoaW1hZ2UsICdiYWNrZ3JvdW5kLWltYWdlJywgYHVybCgke2ltYWdlLmRhdGFzZXQuYmFja2dyb3VuZFNyY30pYCk7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKGltYWdlLCAnZGF0YS1iYWNrZ3JvdW5kLXNyYycpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMub2JzZXJ2ZXIpIHtcclxuXHRcdFx0dGhpcy5vYnNlcnZlci51bm9ic2VydmUoaW1hZ2UpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0b25JbWFnZVByZWxvYWQoc3JjOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikge1xyXG5cdFx0Y29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcblx0XHRpbWcub25sb2FkID0gKCkgPT4ge1xyXG5cdFx0XHRpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soaW1nLnNyYyk7XHJcblx0XHRcdH1cclxuXHRcdH07XHJcblx0XHRpbWcub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7XHJcblx0XHRcdGltZy5vbmVycm9yID0gbnVsbDtcclxuXHRcdFx0aW1nLnNyYyA9ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQVFnQUFBQy9DQU1BQUFBMWtMSzBBQUFBVGxCTVZFWC8vLy9Nek15Wm1abjM5L2ZIeDhmUHo4K09qbzdGeGNYRHc4UG41K2ZTMHRMcTZ1cmw1ZVg4L1B5VWxKVGk0dUxYMTlmdjcrK0ppWW05dmIzZDNkMkZoWVd0cmEycXFxcUFnSUNkbloyc0NSNWxBQUFKVUVsRVFWUjRuTzJkNllLektneUdhN1ZhTjF6cWRMN2UvNDJlaWdFUmtHb2JyTTdKKzJ1bU0zVjVERWtJQ0tlUXhIVUtUNlNuQ0FTSVFJQUlCSWhBZ0FnRWlFQ0FDQVNJUUlBSUJJaEFnQWdFaUVDQUNBU0lRSUFJQkloQWdBZ0VpRUNBQ0FTSVFJQUlCSWhBZ0FnRWlFQ0FDQVNJUUlBSUJJaEFnQWdFNk5zZ3luRmN2dnpxaFh3TlJCazJSVmRuUVJCRVhNOGZzcm9ybW0veCtBcUlzcW5xQU81K0l2NVpYVFZmZ0xFOWlMRG9JZWdJcGppQ3V0ajhzcllGVWFhWkc4SUlJMHMzdFl0TlFUVDFNZ3FDUmQxc2QyMGJna2lEWkRtRlFVbVFiblYxbTRHbzVvd2hpbVRZc1A2MTJ1YjZOZ0tSV202MHYvbEwxblZGK2xRZlNpK0JqVWNVYldJVm00Qm9nc2hrVUtkbWxDeWJ0TDRZTktKZ0ExK3hBWWl3ampRS1FaYzc4cVl3Ny9UNEd0WCtyOUk3Q0sxVlBDbTh6cGZLcHBzYWtmLzI0UnRFbVVXVCs4bnloZGxCbVU5amJaVDVUU3M4ZzJqVW00bFdXbmhZVDcvdDFWUDRCVkZkbFJ0SjFqZjBzRXNVRkZlZmtkUXJpRnJKb0s3ditidFFQVVpTWTEraGNpSi9JRXJGMzBYUjI2Y0psZllSQmQ0Y2hUOFFvV0xVeVVkR1hTbEc4VDdRRi9JR0lsU2Y0NGZuQ0ZYYjhuVzlua0FvSEpMdVkzc3V1OFEzQ1U4Z1ZBNDV4Z0Z6M3piaEIwU3ArQWVrNHl2TkkvTGhNZjJBVUp3YmlqMzBLaThqWGF4akt2SUM0cUlHRERRUzQyR2pDOW94cFh5QTZDYjlwU3NlQ2RsdmlUcTBZd3A1QUpGcUZUa2ZKQkwwemlnK2lNYW9UQ0tTa0swandlNkJvWU1vRlVjcC9RVGE4MVBTZHVUUWdRNUNscU9pc2tqd1NjZ0VKVUx1Z0dHRGFGVGJUVDJRa0NkQUxrOGdneWluZDE3SWVnUmVGQjNwb2pZT1pCQWljZ3JESFVuZ2VVelIrSEJqS0M2SVVEd3RtUVdQZmdLTmhNemZFOVJMUndXUmlac2UyMitGVDZJUlpwWWhIYkFYS2dpUlFrdzh1Z2NTb25GZ0poT29JS1JubkxneGZEOHhkbTV4anRjTEU0UTBDQzFXcG1Qc1FJcWlJbklnbWdRbWlNdmNjekpJTkdudVVQcjZrc1R4OExxaGlDQ2tRWmdOUUNkUi9jUU90ZmZGNThJekNVUVF0Y09YNnlTSytPeFEvTnFYaUg0b1dxS05CMExrRVBiVU45VnlUQ2NKOXRva1JBMFRMWmZBQTFGRnptYXJaMVpPRWd0TUFod1Myb1FhUEJDQlBXUklHU1RhajB3aUZTRVU2ZkxSUU1oNnpHeFhTTStzVWdlSjlxVVRGTjA3TEhlSkJnSzZXNjZla0c0VCtjL3crUHRJd1RRU3IwMWl3UW5YQ0F1RWVFQ1cwWmZxOXRUUUdyUWNNMjlaeTM2dldWMW4xOS9uajJyanVFMWx1Z0pab3NIcGpXT0JFSmQxTVM4cmFCbGo3ZEFhOUh6aXBuakZKbUJLWTJFVHRSWlhjSmxGLzlZTklJR0FtR0Z6NGhjZUgrd2tOTlZzSnBiRWxsamtPT1Vid2dLUnpZZjFBUVNFeEZmOWp1dlVnOFpzOEI0MkVDSnh3ZW1NSTRFSUhjRU1RSnhqZnVjMkVtcHpTdG5vS3RqNWtoYTNkZ2FFRE5nNGQ0QURvbkc0Y0FIaXpIUVMzRWJLMi8zMzkzNlRFOUNiaHlUeDRKOWw4UXdJRVRkUUFpZ1NpQUt1eVpZUlNoQkFRcW55ODMvdmVtZjZqS0QzWXZqLzVnd2tZc0Q2eSt3Z0lNMk9Db3c3UUFJQk5TTnI1aitDTUVrTU5qTDRCZGJlaDYvbjhBVUdSOHRtUUlDVHdCbmhRQUloUXBuMWIwb2tHRHlta2xseEVwQlpuU0hJbm1yd21IQnBkV3dIY1hMM2J0WUpCNFJJcDZ3T1hBVUJVVlRKckNZa3p2OEdNNyt6MGJ2eTMrd2dSSzBZSTZYQ0FSRzYwdDBKQ0NPZnVQSmJ6OEVHSGovYzh6WDhWL2JnMzYvbm5LWDBsaWkzZ0FKQ0JBMXJhakFGWVdaV25FUXFRd3QvdkRjMmhNKzZhYTZ6NFZQMFFGSENCZzRJdUNKN1QxQURjVzc1R2VkSXhOelBDQXNSM1RFN0NPanhvc3pjeHdGUk9ZS0dBV0l3ZUlORU1Za1ZqK2wzN0NCRTJNQklzbkZBUUdOTnJGNUxBOEd1OEhtcWVVd2dFZlBzTkdFTFFKU0p3eld0RkE2STJoRTlEUjhobjErYTJFaXczLzducWwwQTRvUll3ZjBDaVA2RUlhZWg1eE9EbitCdEl6d21DQkhRclgvVVFNVDlaK21QbG1OQ1BzRWpCQThyOFJJUXJ2UmxwYllId2ZyUHVuZ214MnhGRjJPSmovZ1RJTXpNU3BENHY0R1l5YXp5K1A4Q2d2c0kzc0djeVRFSDkzRk1IN0UrYWlpOUtwMUVkZUNvc1Q2UCtCMUlERFpncWQ0ZE5JOVlsVmttL1ljQnBKRWFpYXNnY1QxbVpybStyeEdLY3R6UXowaDBFZ2Z0YTZ6cmZYSWZHVTFxMnpvSnpVVWNwdmU1cGg1eFpyZiswMUxZdnAxRXZzUkg3Szhlc2FKQ2RSWkQzYzNQUTdVUW8zclh2Z2F4dndyVjhwb2xONGxocUx2NEI3Ly9PS3QzRGhEN3Exa3VybUp6UGRvaDN1VmkvRnNuSVhMTVZ5RDJWOFZlT3E0aDcyc28yNGQzUU5FT21WVXlKWkV5TjRnOWptc3NHK2thRzhjWi9GdHg3NnVTakxYY3UrU3pKQTR6MHJWbzdGTWw4WkJEbmZVdzlzbmJlYTVYYXBnTHhCN0hQcGVNaGs5Sk1HdW8xYXQzc3JaOWxOSHdCZk1qZExWWDgxOU5FdUF4RHpNLzR2V01HVk14czNrNWcwUTdCMktmTTJiQytWQTJCK0pwRkV4ZGFpc2Zab3haU1ZoQWxQdWNRK1dZVlRjUG9oLy9WbWZWRFRtbTRqRjVQT2dIUWkwZ2RqcXJ6akh0MFFXQ3d4am5XUTZaVmE1bFZvMTFXc0JPNTFrNlp0NWU5TW1rRGcyWmxVS0N0NWFHbVNCMk8vTjJmaTUyNEh3NVE5Ty9JYlBTczIxem51VnU1MkxQejg3UEw5a0tEUlpsa0REdzduZDJ2bnhmQTJkTkdhTm1OWlY0TTNxSDcydklDaTVPZ3FOSFVVMmlCNzdETjNpdzM3TnlrcEF2OE96eG5hNzV0L3plazR1RStNc3UzL0liVFFMNTdVNlRSSXB1RUg3ZUJNWmFLQ3JYcW5kQ3BTU0VjNTVlL3Q4Ti8wUjZaZ1hhL2J2aHR0VUNQcE9WeFA1WEM3Q3NIL0dwOU16cWRJejFJNHdWUlQ2WDZTZU9zS0tJdnNZTWhveUs3aUhXbVBHeEtOQjA3U0xaeTkzM3FrUHFPbFJvQjFiSE82U0QyUHM2VkdQalFGeW9keVNoTEFlNDk1WEpGTnZGeTM5SGp5bHRZL2RyMVNuUEQ2a2Yya3NuY1lUVkM1WDFMTDJST01aNmxuNldJaDJqNkhGV09GWFd2STBzNzRxL0tXVWQ1TU9zZWFzc0ZQWHg0dUJDb1dJUXgxa0ZlYkpPT25JTjgxRHJZdE5LNmNxQmFlMThjV1RhVFFGRSsydElUWGRMZWV0RVlYMVZqNEY5aGNxSmZJTFE5dURwVnA4cXJQL0dIankwSzlNb2ZaK3VldmsrWGRsZjJxZnJSRHUzS2Fldzd1VTMrKy9sWDkzTDcyVGYzZkV5dDd1anVkZmxYOW5kc2RmOGZwKzEyTyt6K3gvczk5bUxkb0NWb2oyQnBXaVhhQ25hTjF3NUkrMGtMMVUyRlkrU0JnNytXVjI5enJqdzlSVVF2Y3F3NmJmSURrVFllUDdRaDlMR3NXdXlWMzBOQktnTXBiNUVBUFJ0RUxzUmdRQVJDQkNCQUJFSUVJRUFFUWdRZ1FBUkNCQ0JBQkVJRUlFQUVRZ1FnUUFSQ0JDQkFCRUlFSUVBRVFnUWdRQVJDQkNCQUJFSUVJRUFFUWdRZ1FBUkNCQ0JBQkVJRUlFQVBVR1F1UDREVDJSd2h5VWtnYzRBQUFBQVNVVk9SSzVDWUlJPSc7XHJcblx0XHR9O1xyXG5cdFx0aW1nLnNyYyA9IHNyYztcclxuXHR9XHJcblxyXG59XHJcbiJdfQ==